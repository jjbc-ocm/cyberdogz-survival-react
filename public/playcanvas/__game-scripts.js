var Initialization=pc.createScript("initialization");class UI{constructor(e,t){this.id=e,this.element=null,t?(this.element=$(t),this.element.attr("id",e)):this.element=$(`#${e}`),this.onShow=null,this.onHide=null}getChild(e){return this.element.find(`#${e}`)}show(){SoundManager.instance.play("Open UI"),this.element.show(),this.onShow&&this.onShow()}hide(){SoundManager.instance.play("Open UI"),this.element.hide(),this.onHide&&this.onHide()}}class TabsUI extends UI{constructor(e){super(e),this.elementTabs=$(`#${e} #tabs-ui`).find("li").map(((e,t)=>$(t)));for(let e=0;e<this.elementTabs.length;e++)this.elementTabs[e].on("click",this.onTabClick.bind(this,e));this.onTabClickCallback=null}onTabClick(e){SoundManager.instance.play("Open UI");for(let e=0;e<this.elementTabs.length;e++)this.elementTabs[e].removeClass("tab-selected-ui").addClass("tab-default-ui");this.elementTabs[e].removeClass("tab-default-ui").addClass("tab-selected-ui"),this.onTabClickCallback&&this.onTabClickCallback(e)}}class ListUI extends UI{constructor(e,t){super(e),this.elementItems=$(`#${e} #${t}`)}clear(){this.elementItems.empty()}initializeItems(e,t){this.clear();for(let i=0;i<e.length;i++){let s=t(e[i],i);this.elementItems.append(s.element)}}}class TabListUI extends TabsUI{constructor(e,t){super(e),this.elementItems=$(`#${e} #${t}`)}clear(){this.elementItems.empty()}initializeItems(e,t){this.clear();for(let i=0;i<e.length;i++){let s=t(e[i],i);this.elementItems.append(s.element)}}}class LoadingUI extends UI{constructor(){super("loading-ui")}}Initialization.prototype.initialize=function(){pc.UI=UI,pc.TabsUI=TabsUI,pc.ListUI=ListUI,pc.TabListUI=TabListUI,pc.LoadingUI=LoadingUI,pc.app.getLevelByExp=function(e){let t=1,i=100;for(;e>=i;)i+=100*Math.pow(1.25,t),t++;return t},pc.app.getMaxExpByTier=function(e){return function calculateExpForLevel(e){let t=0;for(let i=1;i<e-1;i++)t+=100*Math.pow(1.25,i-1);return t}(1+5*e)}};var DataManager=pc.createScript("dataManager");DataManager.instance=null,DataManager.attributes.add("enemiesJson",{type:"asset",assetType:"json"}),DataManager.attributes.add("weaponsJson",{type:"asset",assetType:"json"}),DataManager.attributes.add("bulletsJson",{type:"asset",assetType:"json"}),DataManager.attributes.add("upgradesJson",{type:"asset",assetType:"json"}),DataManager.attributes.add("dropsJson",{type:"asset",assetType:"json"}),DataManager.attributes.add("raritiesJson",{type:"asset",assetType:"json"}),DataManager.prototype.initialize=function(){DataManager.instance=this,this.enemiesData=this.app.assets.get(this.enemiesJson.id).resource,this.weaponsData=this.app.assets.get(this.weaponsJson.id).resource,this.bulletsData=this.app.assets.get(this.bulletsJson.id).resource,this.upgradesData=this.app.assets.get(this.upgradesJson.id).resource,this.dropsData=this.app.assets.get(this.dropsJson.id).resource,this.raritiesData=this.app.assets.get(this.raritiesJson.id).resource},DataManager.prototype.getEnemy=function(a){return this.enemiesData.data.find((t=>t.id===a))},DataManager.prototype.getWeapon=function(a){return this.weaponsData.data.find((t=>t.id===a))},DataManager.prototype.getUpgradeInfo=function(a){return console.log("getUpgradeInfo",a),this.upgradesData.info.find((t=>t.id===a))},DataManager.prototype.getRandomUpgrades=function(a,t){let e=[],s=[];for(let t=1;t<this.upgradesData.data.length;t++){if(this.upgradesData.data[t].isWeaponUpgrade)for(let s=0;s<a.weapons.length;s++)e.push({...this.upgradesData.data[t],weaponIndex:s});else e.push({...this.upgradesData.data[t]})}for(let a=e.length-1;a>0;a--){let t=Math.floor(Math.random()*(a+1));[e[a],e[t]]=[e[t],e[a]]}for(e=e.filter((t=>{let e=t.isWeaponUpgrade?a.getWeapon(t.weaponIndex):a;return t.conditions.every((a=>{let t=a.keys.reduce(((a,t)=>a&&a[t]),e);return t=t||0,">"===a.operator?t>a.value:"<"===a.operator?t<a.value:">="===a.operator?t>=a.value:"<="===a.operator?t<=a.value:t==a.value}))})),s=e.slice(0,t);s.length<t;)s.push(this.upgradesData.data[0]);return s},DataManager.prototype.getBullet=function(a){return this.bulletsData.data.find((t=>t.id===a))},DataManager.prototype.getDrop=function(a){return this.dropsData.data.find((t=>t.id===a))},DataManager.prototype.getRarity=function(a){return this.raritiesData.data.find((t=>t.id===a))};var GameUi=pc.createScript("gameUi");GameUi.instance=null,GameUi.attributes.add("htmlAsset",{type:"asset",assetType:"html",title:"HTML Asset"}),GameUi.attributes.add("cssAsset",{type:"asset",assetType:"css",title:"CSS Asset"}),GameUi.attributes.add("htmlWeaponItem",{type:"asset",assetType:"html"}),GameUi.attributes.add("htmlUpgradeItem",{type:"asset",assetType:"html"}),GameUi.prototype.initialize=function(){GameUi.instance=this,$("head").append('<style id="game-ui-css">'+this.cssAsset.resource+"</style>"),$("body").append('<div id="game-ui-html">'+this.htmlAsset.resource+"</div>"),this.setUpListeners(),this.isInitialized=!1,this.initializeUI()},GameUi.prototype.initializeUI=function(){class EquippedWeaponUI extends pc.UI{constructor(t,e,i){super(t,e),this.data=i,this.render()}render(){if(!this.data||!this.data.isUnlocked)return;let t=DataManager.instance.getRarity(this.data.ugsData.instanceData.rarity),e=DataManager.instance.getWeapon(this.data.ugsData.instanceData.id);this.getChild("content-ui").css({"border-color":t.borderColor,background:`linear-gradient(to bottom, #22222299 0%, ${t.backColor} 100%)`}),this.getChild("item-img").attr("src",pc.app.assets.get(e.iconId).getFileUrl())}}class RewardWeaponUI extends pc.UI{constructor(t,e,i){super(t,e),this.data=i,this.render()}render(){let t=DataManager.instance.getRarity(this.data.ugsData.instanceData.rarity),e=DataManager.instance.getWeapon(this.data.ugsData.instanceData.id),i=this.data.ugsData.instanceData.tier,s=['<i class="fa fa-star" aria-hidden="true"></i>','<i class="fa fa-star-half-o" aria-hidden="true"></i>'];this.getChild("content-ui").css({"border-color":this.isSelected?"#FFFFFFFF":t.borderColor,background:`linear-gradient(to bottom, #22222299 0%, ${this.isSelected?"#FFFFFFFF":t.backColor} 100%)`}),this.getChild("item-img").attr("src",pc.app.assets.get(e.iconId).getFileUrl()),this.getChild("level-text").text(pc.app.getLevelByExp(this.data.ugsData.instanceData.exp)),this.getChild("tier-ui").css({color:t.borderColor}),this.getChild("tier-ui").empty();for(let t=1;t<=i;t++)t%2==0?this.getChild("tier-ui").append($(s[0])):t===i&&this.getChild("tier-ui").append($(s[1]))}}class UpgradeUI extends pc.UI{constructor(t,e,i){super(t,e),console.log(t,e),this.data=i,this.element.on("click",this.onClick.bind(this)),this.render()}onClick(){GameManager.instance.isPaused=!1,GameUi.instance.uiUpgrades.hide(),Player.instance.applyUpgrade(this.data)}render(){let weapon=Player.instance.getWeapon(this.data.weaponIndex);this.getChild("name-text").text(this.data.name||eval(this.data.getName)),this.getChild("info-text").text(this.data.info||eval(this.data.getInfo)),this.getChild("upgrade-img").attr("src",pc.app.assets.get(this.data.icon||eval(this.data.getIcon)).getFileUrl())}}class PlayerUI extends pc.ListUI{constructor(t){super("player-ui","items"),this.htmlItem=t}renderStats(){}renderWeapons(t){this.initializeItems(t,((t,e)=>new EquippedWeaponUI(`item-${e}`,this.htmlItem,t)))}}class UpgradesUI extends pc.ListUI{constructor(t){super("upgrades-ui","items"),this.htmlItem=t,this.state={upgrades:[]},this.onShow=()=>{this.render()}}render(){this.initializeItems(this.state.upgrades,((t,e)=>(console.log("UpgradesUI",e,t),new UpgradeUI(`item-${e}`,this.htmlItem,t))))}}class ResultsUI extends pc.ListUI{constructor(t){super("results-ui","items"),this.htmlItem=t,this.state={score:0,items:[]},this.onShow=()=>{this.render()}}render(){let t=GameManager.instance.time,e=GameManager.instance.kills,i=Player.instance.stats.level,s=Player.instance.stats.kibblez,a=this.state.score,n=`${Math.floor(t/60).toString().padStart(2,"0")}:${Math.floor(t%60).toString().padStart(2,"0")}`;this.getChild("back-light-img").attr("src",pc.app.assets.get(173430750).getFileUrl()),this.getChild("time-text").text(n),this.getChild("kills-text").text(e),this.getChild("level-text").text(i),this.getChild("kibblez-text").text(s),this.getChild("score-text").text(a),this.initializeItems(this.state.items,((t,e)=>new RewardWeaponUI(`item-${e}`,this.htmlItem,{isUnlocked:!0,ugsData:t})))}}class TutorialUI extends pc.UI{constructor(){super("tutorial-ui"),this.data=[{src:173404098,desc:"Swipe anywhere on screen to move."},{src:173404100,desc:"Avoid taking damage from the enemy to survive."},{src:173404099,desc:"Approach plants to gain surge boost."},{src:173404098,desc:"Once surge bar is full, you will be in surge state."}],this.state={panelIndex:0,maxPanel:4},this.getChild("prev-panel-button").on("click",this.onPrevPanelClick.bind(this)),this.getChild("next-panel-button").on("click",this.onNextPanelClick.bind(this)),this.getChild("confirm-button").on("click",this.onConfirmClick.bind(this)),this.render()}onPrevPanelClick(){this.state.panelIndex-=1,this.render()}onNextPanelClick(){this.state.panelIndex+=1,this.render()}onConfirmClick(){this.hide(),GameManager.instance.isPaused=!1}render(){let t=this.data[this.state.panelIndex];this.getChild("preview-img").attr("src",pc.app.assets.get(t.src).getFileUrl()),this.getChild("desc-text").text(t.desc),this.state.panelIndex>0?this.getChild("prev-panel-button").show():this.getChild("prev-panel-button").hide(),this.state.panelIndex<this.state.maxPanel-1?this.getChild("next-panel-button").show():this.getChild("next-panel-button").hide(),this.state.panelIndex===this.state.maxPanel-1?this.getChild("confirm-button").show():this.getChild("confirm-button").hide()}}this.uiPlayer=new PlayerUI(this.htmlWeaponItem.resource),this.uiUpgrades=new UpgradesUI(this.htmlUpgradeItem.resource),this.uiResults=new ResultsUI(this.htmlWeaponItem.resource),this.uiLoading=new pc.LoadingUI,this.uiTutorial=new TutorialUI},GameUi.prototype.setUpListeners=function(){this.boundOnPlayAgainClick=this.onPlayAgainClick.bind(this),this.boundOnHomeClick=this.onHomeClick.bind(this),this.boundOnPauseClick=this.onPauseClick.bind(this),$("#play-again-button").on("click",this.boundOnPlayAgainClick),$("#home-button").on("click",this.boundOnHomeClick),$("#pause-button").on("click",this.boundOnPauseClick)},GameUi.prototype.destroyListeners=function(){$("#play-again-button").off("click",this.boundOnPlayAgainClick),$("#home-button").off("click",this.boundOnHomeClick),$("#pause-button").off("click",this.boundOnPauseClick)},GameUi.prototype.update=function(t){let e=Player.instance,i=e.entity.script.unit;this.isInitialized||(this.updateExpLevel(e.getExp(),e.getMaxExp(),e.getLevel()),this.updateHealth(i.getHealth(),i.getMaxHealth()),this.updateImages(),this.isInitialized=!0),this.updateSurge(e.getSurge(),e.getMaxSurge())},GameUi.prototype.onPauseClick=function(t){GameManager.instance.isPaused=!0,this.onHomeClick()},GameUi.prototype.onPlayAgainClick=function(t){$("#game-ui-css").remove(),$("#game-ui-html").remove(),this.destroyListeners(),BulletManager.instance.destroyListeners(),this.app.scenes.changeScene("Game")},GameUi.prototype.onHomeClick=function(t){$("#game-ui-css").remove(),$("#game-ui-html").remove(),this.destroyListeners(),BulletManager.instance.destroyListeners(),this.app.scenes.changeScene("Home")},GameUi.prototype.updateImages=function(){$("#kibblez-img").attr("src",this.app.assets.get(170325327).getFileUrl())},GameUi.prototype.updateExpLevel=function(t,e,i){let s=t/e*100;$("#exp-ui #bar").css("width",s+"%"),$("#exp-ui #level-text").text(i)},GameUi.prototype.updateHealth=function(t,e){let i=t/e*100;$("#health-ui #bar").css("width",i+"%")},GameUi.prototype.updateSurge=function(t,e){let i=t/e*100;$("#surge-ui #bar").css("width",i+"%")},GameUi.prototype.updateTime=function(t){$("#time-text").text(`${Math.floor(t/60).toString().padStart(2,"0")}:${Math.floor(t%60).toString().padStart(2,"0")}`)},GameUi.prototype.updateKills=function(t){$("#kills-text").text(t)},GameUi.prototype.updateKibblez=function(t){$("#kibblez-text").text(t)},GameUi.prototype.updateWeapons=function(t){this.uiPlayer.renderWeapons(t)},GameUi.prototype.showLevelUp=function(t){GameManager.instance.isPaused=!0,SoundManager.instance.play("Open UI"),this.uiUpgrades.state.upgrades=t,this.uiUpgrades.show()},GameUi.prototype.showGameOver=function(){let t=Player.instance,e=GameManager.instance;this.uiLoading.show(),NetworkManager.instance.postGame(t.stats.kibblez,e.time,e.kills,t,pc.targetLeaderboards,(t=>{this.uiLoading.hide(),this.uiResults.state.score=t.score,this.uiResults.state.items=t.items,this.uiResults.show()}),(t=>{}))};var HomeUi=pc.createScript("homeUi");HomeUi.instance=null,HomeUi.attributes.add("htmlAsset",{type:"asset",assetType:"html"}),HomeUi.attributes.add("cssAsset",{type:"asset",assetType:"css"}),HomeUi.attributes.add("htmlLeaderboardDefaultItem",{type:"asset",assetType:"html"}),HomeUi.attributes.add("htmlLeaderboardSelectedItem",{type:"asset",assetType:"html"}),HomeUi.attributes.add("htmlWeaponItem",{type:"asset",assetType:"html"}),HomeUi.prototype.initialize=function(){HomeUi.instance=this,$("head").append(`<style id="home-ui-css">${this.cssAsset.resource}</style>`),$("body").append(`<div id="home-ui-html">${this.htmlAsset.resource}</div>`);class TopBarUI extends pc.UI{constructor(){super("topbar-ui"),this.state={name:"",score:0,cbz:0},HomeUi.instance.uiLoading.show(),localStorage.getItem("walletId")?SolanaManager.instance.fetchTokenBalances(localStorage.getItem("walletId"),(t=>{this.state.cbz=t.cbzBalances.length?t.cbzBalances[0].uiAmount:0,this.networkGetHome()}),(()=>{})):this.networkGetHome()}networkGetHome(){NetworkManager.instance.getHome((t=>{HomeUi.instance.uiLoading.hide(),HomeManager.instance.currencies=t.currencies,this.state.name=t.name,this.state.score=t.score,this.render()}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to load player information.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.networkGetHome()},HomeUi.instance.uiNetworkError.show()}))}render(){let t=NetworkManager.instance.getBalance(HomeManager.instance.currencies,"KIBBLEZ");this.getChild("name-text").text(this.state.name),this.getChild("kibblez-text").text(`${t} KIBBLEZ`),this.getChild("cbz-text").text(`${this.state.cbz} CBZ`),this.getChild("high-score-text").text(this.state.score),localStorage.getItem("walletId")?this.getChild("wallet-id-text").text(localStorage.getItem("walletId")):this.getChild("wallet-id-text").hide()}}class FullScreenUI extends pc.TabListUI{constructor(t){super(t,"items"),this.getChild("back-button").on("click",this.hide.bind(this)),this.onShow=()=>{this.onTabClick(0)}}}class InventoryItemUI extends pc.UI{constructor(t,e,i,s){super(t,e),this.data=i,this.isSelected=!1,s&&(this.onClickCallback=s,this.element.on("click",this.onClick.bind(this))),this.render()}onClick(){this.onClickCallback(this)}setSelected(t){this.isSelected=t,this.render()}render(){if(this.data){let t=DataManager.instance.getRarity(this.data.instanceData.rarity),e=DataManager.instance.getWeapon(this.data.instanceData.id),i=this.data.instanceData.tier,s=['<i class="fa fa-star" aria-hidden="true"></i>','<i class="fa fa-star-half-o" aria-hidden="true"></i>'];this.getChild("content-ui").css({"border-color":this.isSelected?"#FFFFFFFF":t.borderColor,background:`linear-gradient(to bottom, #22222299 0%, ${this.isSelected?"#FFFFFFFF":t.backColor} 100%)`}),this.getChild("item-img").attr("src",pc.app.assets.get(e.iconId).getFileUrl()),this.getChild("level-text").text(pc.app.getLevelByExp(this.data.instanceData.exp)),this.getChild("tier-ui").css({color:t.borderColor}),this.getChild("tier-ui").empty();for(let t=1;t<=i;t++)t%2==0?this.getChild("tier-ui").append($(s[0])):t===i&&this.getChild("tier-ui").append($(s[1]))}else this.getChild("content-ui").css({"border-color":"",background:""}),this.getChild("item-img").removeAttr("src"),this.getChild("level-text").text(""),this.getChild("tier-ui").css({color:""}),this.getChild("tier-ui").empty()}}class SelectedItemsUI extends pc.ListUI{constructor(t){super("selected-items-ui","selected-items"),this.htmlItem=t}render(t){this.initializeItems(t,((t,e)=>new InventoryItemUI(`item-${e}`,this.htmlItem,t,(t=>{}))))}}class PreviousTourneyUI extends pc.UI{constructor(){super("previous-tourney-ui"),this.state={cbzRegistration:null,tourneyId:"",items:[],rank:0},this.getChild("confirm-button").on("click",this.onConfirmButtonClick.bind(this)),this.onShow=()=>{this.render()}}onConfirmButtonClick(){HomeUi.instance.uiLoading.show(),NetworkManager.instance.cyberdogzAuth((t=>{localStorage.setItem("cyberdogzToken",t.token),this.onSignMessage()}))}onSignMessage(){let t=this.getRewardAmount();SolanaManager.instance.receiveToken("You are sign in the phantom for claim reward.",t,(e=>{this.onCyberdogzReward(e,t)}),(t=>{console.log("error",t)}))}onCyberdogzReward(t,e){let i="FREE_TOURNEY"===this.state.tourneyId?"free":"premium",s=this.state.cbzRegistration.survival._id;NetworkManager.instance.cyberdogzReward(i,t,s,this.state.rank,e,1,(t=>{this.onUnityReward()}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to claim reward (Cyberdogz).",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.onCyberdogzReward()},HomeUi.instance.uiNetworkError.show()}))}onUnityReward(){NetworkManager.instance.postConcludeTourney(this.state.tourneyId,(t=>{HomeUi.instance.uiLoading.hide(),HomeUi.instance.uiTopBar.render(),this.hide()}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to claim reward (Unity).",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.onUnityReward()},HomeUi.instance.uiNetworkError.show()}))}getRewardAmount(){let t=localStorage.getItem("userId"),e=this.state.items.find((e=>e.playerId===t));this.state.rank=e.rank+1;let i=1===this.state.rank?.5:2===this.state.rank?.2:3===this.state.rank?.15:4===this.state.rank?.1:5===this.state.rank?.05:0,s=10;if("PREMIUM_TOURNEY"===this.state.tourneyId){s=100+10*this.state.items.length}return Math.floor(s*i)}render(){let t=localStorage.getItem("userId"),e=this.state.items.find((e=>e.playerId===t)),i=this.getRewardAmount();this.getChild("name-text").text(e.playerName),this.getChild("rank-text").text(`Rank No. ${this.state.rank}`),this.getChild("confirm-button").text(`+${i} CBZ`)}}class UpgradeUI extends pc.UI{constructor(){super("upgrade-ui"),this.state={mainItem:null,resultItem:null,exp:1},this.getChild("close-button").on("click",this.hide.bind(this)),this.getChild("confirm-button").on("click",this.onUpgradeClick.bind(this)),this.getChild("exp-slider").on("input",this.onExpSliderInput.bind(this)),this.onShow=()=>{this.render(),this.renderDynamicInfo()}}onUpgradeClick(){HomeUi.instance.uiLoading.show(),NetworkManager.instance.postUpgrade(this.state.mainItem.playersInventoryItemId,this.state.exp,(t=>{if(t.isSuccess){HomeUi.instance.uiLoading.hide();for(let e=0;e<t.currencies.length;e++){let i=HomeManager.instance.currencies.findIndex((i=>i.currencyId===t.currencies[e].currencyId));HomeManager.instance.currencies[i]=t.currencies[e]}HomeUi.instance.uiTopBar.render(),this.hide(),HomeUi.instance.uiShowcase.state.selectedItem=this.state.resultItem,HomeUi.instance.uiShowcase.show()}}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to upgrade item.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.onUpgradeClick()},HomeUi.instance.uiNetworkError.show()}))}onExpSliderInput(){this.state.exp=parseInt(this.getChild("exp-slider").val(),10),this.state.resultItem?this.state.resultItem.instanceData.exp=this.state.mainItem.instanceData.exp+this.state.exp:this.state.resultItem={...this.state.mainItem,instanceData:{id:this.state.mainItem.instanceData.id,rarity:this.state.mainItem.instanceData.rarity,tier:this.state.mainItem.instanceData.tier,exp:this.state.mainItem.instanceData.exp+this.state.exp}},this.renderDynamicInfo()}render(){let t=NetworkManager.instance.getBalance(HomeManager.instance.currencies,"KIBBLEZ"),e=pc.app.getMaxExpByTier(this.state.mainItem.instanceData.tier),i=this.state.mainItem.instanceData.exp||0,s=Math.ceil(Math.max(0,Math.min(t,e-i)));this.getChild("exp-slider").attr({min:"1",max:`${s}`}),this.getChild("exp-slider").val(this.state.exp),this.getChild("confirm-button").prop("disabled",0===s),new InventoryItemUI("main-item-ui",this.getChild("main-item-ui"),this.state.mainItem)}renderDynamicInfo(){this.getChild("slider-text").text(`Use ${this.state.exp} KIBBLEZ`),this.getChild("confirm-button").text(`+${this.state.exp} EXP`),new InventoryItemUI("result-item-ui",this.getChild("result-item-ui"),this.state.resultItem)}}class TierUpUI extends pc.ListUI{constructor(){super("tier-up-ui","items"),this.state={items:[],mainItem:null,subItem:null,resultItem:null},this.getChild("close-button").on("click",this.hide.bind(this)),this.getChild("confirm-button").on("click",this.onMergeClick.bind(this)),this.onShow=()=>{this.render()}}selectSubItem(t){this.state.subItem=t,this.state.resultItem={...this.state.mainItem,instanceData:{id:this.state.mainItem.instanceData.id,rarity:this.state.mainItem.instanceData.rarity,tier:this.state.mainItem.instanceData.tier+1,exp:this.state.mainItem.instanceData.exp+this.state.subItem.instanceData.exp}},this.render()}onMergeClick(){HomeUi.instance.uiLoading.show(),NetworkManager.instance.postTierUp(this.state.mainItem.playersInventoryItemId,this.state.subItem.playersInventoryItemId,(t=>{HomeUi.instance.uiLoading.hide(),this.hide(),HomeUi.instance.uiShowcase.state.selectedItem=this.state.resultItem,HomeUi.instance.uiShowcase.show()}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to merge items.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.onMergeClick()},HomeUi.instance.uiNetworkError.show()}))}render(){this.getChild("confirm-button").prop("disabled",!this.state.subItem),new InventoryItemUI("main-item-ui",this.getChild("main-item-ui"),this.state.mainItem),new InventoryItemUI("sub-item-ui",this.getChild("sub-item-ui"),this.state.subItem),new InventoryItemUI("result-item-ui",this.getChild("result-item-ui"),this.state.resultItem),this.initializeItems(this.state.items,((t,e)=>new InventoryItemUI(`item-${e}`,HomeUi.instance.htmlWeaponItem.resource,t,(t=>this.selectSubItem(t.data)))))}}class RarityUpUI extends pc.ListUI{constructor(){super("rarity-up-ui","items"),this.state={items:[],mainItem:null,subItem:null,resultItem:null},this.getChild("close-button").on("click",this.hide.bind(this)),this.getChild("confirm-button").on("click",this.onMergeClick.bind(this)),this.onShow=()=>{this.render()}}selectSubItem(t){this.state.subItem=t,this.state.resultItem={...this.state.mainItem,instanceData:{id:this.state.mainItem.instanceData.id,rarity:this.state.mainItem.instanceData.rarity+1,tier:this.state.mainItem.instanceData.tier,exp:this.state.mainItem.instanceData.exp+this.state.subItem.instanceData.exp}},this.render()}onMergeClick(){HomeUi.instance.uiLoading.show(),NetworkManager.instance.postRarityUp(this.state.mainItem.playersInventoryItemId,this.state.subItem.playersInventoryItemId,(t=>{HomeUi.instance.uiLoading.hide(),this.hide(),HomeUi.instance.uiShowcase.state.selectedItem=this.state.resultItem,HomeUi.instance.uiShowcase.show()}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to rare up items.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.onMergeClick()},HomeUi.instance.uiNetworkError.show()}))}render(){this.getChild("confirm-button").prop("disabled",!this.state.subItem),new InventoryItemUI("main-item-ui",this.getChild("main-item-ui"),this.state.mainItem),new InventoryItemUI("sub-item-ui",this.getChild("sub-item-ui"),this.state.subItem),new InventoryItemUI("result-item-ui",this.getChild("result-item-ui"),this.state.resultItem),this.initializeItems(this.state.items,((t,e)=>new InventoryItemUI(`item-${e}`,HomeUi.instance.htmlWeaponItem.resource,t,(t=>this.selectSubItem(t.data)))))}}class ShowcaseUI extends pc.UI{constructor(){super("showcase-ui"),this.element.on("click",this.onConfirmClick.bind(this)),this.state={selectedItem:null},this.onShow=()=>{this.render()}}onConfirmClick(){this.hide(),HomeUi.instance.uiInventory.show()}render(){let t=DataManager.instance.getRarity(this.state.selectedItem.instanceData.rarity),e=DataManager.instance.getWeapon(this.state.selectedItem.instanceData.id),i=this.state.selectedItem.instanceData.tier,s=pc.app.getLevelByExp(this.state.selectedItem.instanceData.exp),a=pc.app.getLevelByExp(pc.app.getMaxExpByTier(i));this.getChild("name-text").text(e.name),this.getChild("level-text").text(`Lv. ${s} / ${a}`),this.getChild("damage-text").text(Math.round(100*e.damageRate)/100),this.getChild("fire-rate-text").text(Math.round(100*e.fireRate)/100+"/s"),this.getChild("back-light-img").attr("src",pc.app.assets.get(t.src).getFileUrl()),this.getChild("item-img").attr("src",pc.app.assets.get(e.iconId).getFileUrl()),this.getChild("tier-ui").empty();for(let t=1;t<=i;t++)t%2==0?this.getChild("tier-ui").append($('<i class="fa fa-star" aria-hidden="true"></i>')):t===i&&this.getChild("tier-ui").append($('<i class="fa fa-star-half-o" aria-hidden="true"></i>'))}}class NetworkErrorUI extends pc.UI{constructor(){super("network-error-ui"),this.state={message:"",refreshCallback:null},this.getChild("confirm-button").on("click",this.onRefreshClick.bind(this)),this.onShow=()=>{this.render()}}onRefreshClick(){this.state.refreshCallback(),this.hide()}render(){this.getChild("details-text").text(this.state.message)}}class FooterUI extends pc.UI{constructor(){super("footer-ui"),this.getChild("profile-button").on("click",this.onProfileClick.bind(this)),this.getChild("items-button").on("click",this.onItemsClick.bind(this)),this.getChild("home-button").on("click",this.onHomeClick.bind(this)),this.getChild("swap-button").on("click",this.onSwapClick.bind(this)),this.getChild("help-button").on("click",this.onHelpClick.bind(this))}onProfileClick(){}onItemsClick(){HomeUi.instance.uiInventory.show()}onHomeClick(){}onSwapClick(){}onHelpClick(){}}this.uiLoading=new pc.LoadingUI,this.uiTopBar=new TopBarUI,this.uiLeaderboards=new class LeaderboardsUI extends FullScreenUI{constructor(t,e){super("leaderboards-ui"),this.htmlSelected=t,this.htmlDefault=e,this.onTabClickCallback=t=>{let e=0===t?"ALL_TIME":1===t?"WEEKLY":"DAILY";this.loadLeaderboard(e)}}loadLeaderboard(t){HomeUi.instance.uiLoading.show(),NetworkManager.instance.getLeaderboard(t,(t=>{HomeUi.instance.uiLoading.hide(),this.initializeItems(t.results,((t,e)=>{let i=t.playerId==localStorage.getItem("userId")?this.htmlSelected:this.htmlDefault,s=new UI(`item-${e}`,i);return s.getChild("rank-text").text(`${t.rank+1}`),s.getChild("name-text").text(t.playerName),s.getChild("meta-text").text("---"),s.getChild("score-text").text(t.score),s}))}),(e=>{HomeUi.instance.uiNetworkError.state.message="Failed to load leaderboard.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.loadLeaderboard(t)},HomeUi.instance.uiNetworkError.show()}))}}(this.htmlLeaderboardSelectedItem.resource,this.htmlLeaderboardDefaultItem.resource),this.uiInventory=new class InventoryUI extends FullScreenUI{constructor(t){super("inventory-ui"),this.htmlItem=t,this.state={selectedItem:null,weapons:[],nextUrl:null},this.getChild("upgrade-button").on("click",this.onUpgradeClick.bind(this)),this.getChild("tier-button").on("click",this.onTierClick.bind(this)),this.getChild("rarity-button").on("click",this.onRarityClick.bind(this)),this.onTabClickCallback=t=>{0===t&&(this.state.weapons=[],this.loadItems())}}selectItem(t){this.state.selectedItem=t,this.renderSelectedItem()}loadItems(){this.getChild("visibility-ui").hide(),HomeUi.instance.uiLoading.show(),NetworkManager.instance.getWeapons(this.state.nextUrl,(t=>{HomeUi.instance.uiLoading.hide(),this.state.weapons.push(...t.results),this.state.nextUrl=t.links.next,this.state.nextUrl?this.loadItems():this.render()}))}render(){this.state.weapons.sort(((t,e)=>t.instanceData.rarity>e.instanceData.rarity?-1:t.instanceData.rarity<e.instanceData.rarity?1:t.instanceData.id>e.instanceData.id?-1:t.instanceData.id<e.instanceData.id?1:t.instanceData.tier>e.instanceData.tier?-1:t.instanceData.tier<e.instanceData.tier?1:0)),this.initializeItems(this.state.weapons,((t,e)=>new InventoryItemUI(`item-${e}`,this.htmlItem,t,(t=>this.selectItem(t.data)))))}renderSelectedItem(){let t=DataManager.instance.getRarity(this.state.selectedItem.instanceData.rarity),e=DataManager.instance.getWeapon(this.state.selectedItem.instanceData.id),i=this.state.selectedItem.instanceData.tier,s=pc.app.getLevelByExp(this.state.selectedItem.instanceData.exp),a=pc.app.getLevelByExp(pc.app.getMaxExpByTier(i));this.getChild("visibility-ui").show(),this.getChild("name-text").text(e.name),this.getChild("level-text").text(`Lv. ${s} / ${a}`),this.getChild("damage-text").text(Math.round(100*e.damageRate)/100),this.getChild("fire-rate-text").text(Math.round(100*e.fireRate)/100+"/s"),this.getChild("back-light-img").attr("src",pc.app.assets.get(t.src).getFileUrl()),this.getChild("item-img").attr("src",pc.app.assets.get(e.iconId).getFileUrl()),this.getChild("tier-ui").empty();for(let t=1;t<=i;t++)t%2==0?this.getChild("tier-ui").append($('<i class="fa fa-star" aria-hidden="true"></i>')):t===i&&this.getChild("tier-ui").append($('<i class="fa fa-star-half-o" aria-hidden="true"></i>'));this.getChild("upgrade-button").prop("disabled",s>=a),this.getChild("tier-button").prop("disabled",i>=10),this.getChild("rarity-button").prop("disabled",this.state.selectedItem.instanceData.rarity>=6)}onUpgradeClick(){HomeUi.instance.uiUpgrade.state.mainItem=this.state.selectedItem,HomeUi.instance.uiUpgrade.state.resultItem=null,HomeUi.instance.uiUpgrade.state.exp=1,HomeUi.instance.uiUpgrade.show()}onTierClick(){HomeUi.instance.uiTierUp.state.mainItem=this.state.selectedItem,HomeUi.instance.uiTierUp.state.subItem=null,HomeUi.instance.uiTierUp.state.resultItem=null,HomeUi.instance.uiTierUp.state.items=this.state.weapons.filter((t=>t.instanceData.tier===this.state.selectedItem.instanceData.tier&&t.playersInventoryItemId!==this.state.selectedItem.playersInventoryItemId)),HomeUi.instance.uiTierUp.show()}onRarityClick(){HomeUi.instance.uiRarityUp.state.mainItem=this.state.selectedItem,HomeUi.instance.uiRarityUp.state.subItem=null,HomeUi.instance.uiRarityUp.state.resultItem=null,HomeUi.instance.uiRarityUp.state.items=this.state.weapons.filter((t=>t.instanceData.rarity===this.state.selectedItem.instanceData.rarity&&t.instanceData.id===this.state.selectedItem.instanceData.id&&t.playersInventoryItemId!==this.state.selectedItem.playersInventoryItemId)),HomeUi.instance.uiRarityUp.show()}}(this.htmlWeaponItem.resource),this.uiBriefing=new class BriefingUI extends FullScreenUI{constructor(t){super("briefing-ui"),this.htmlItem=t,this.uiSelectedItems=new SelectedItemsUI(t),this.state={weapons:[],selectedWeapons:[],nextUrl:null,maxItems:4},this.getChild("battle-button").on("click",this.onBattleClick.bind(this)),this.onTabClickCallback=t=>{0===t&&(this.state.weapons.length=0,this.state.selectedWeapons.length=0,this.loadItems(),this.renderContent())}}toggleItem(t){let e=this.state.selectedWeapons.findIndex((e=>e.playersInventoryItemId===t.data.playersInventoryItemId));e>=0?(this.state.selectedWeapons.splice(e,1),t.setSelected(!1)):this.state.selectedWeapons.length<this.state.maxItems&&(this.state.selectedWeapons.push(t.data),t.setSelected(!0)),this.renderContent()}loadItems(){HomeUi.instance.uiLoading.show(),NetworkManager.instance.getWeapons(this.state.nextUrl,(t=>{HomeUi.instance.uiLoading.hide(),this.state.weapons.push(...t.results),this.state.nextUrl=t.links.next,this.state.nextUrl?this.loadItems():this.renderItems()}))}renderContent(){this.uiSelectedItems.render(this.state.selectedWeapons),this.getChild("selected-text").text(`Selected: ${this.state.selectedWeapons.length} / ${this.state.maxItems}`),this.getChild("battle-button").prop("disabled",0===this.state.selectedWeapons.length)}renderItems(){this.state.weapons.sort(((t,e)=>t.instanceData.rarity>e.instanceData.rarity?-1:t.instanceData.rarity<e.instanceData.rarity?1:t.instanceData.id>e.instanceData.id?-1:t.instanceData.id<e.instanceData.id?1:t.instanceData.tier>e.instanceData.tier?-1:t.instanceData.tier<e.instanceData.tier?1:0)),this.initializeItems(this.state.weapons,((t,e)=>new InventoryItemUI(`item-${e}`,this.htmlItem,t,(t=>{this.toggleItem(t)}))))}onBattleClick(){SoundManager.instance.play("Open UI"),$("#home-ui-css").remove(),$("#home-ui-html").remove(),pc.weapons=this.state.selectedWeapons,pc.app.scenes.changeScene("Game")}}(this.htmlWeaponItem.resource),this.uiTournament=new class TournamentUI extends FullScreenUI{constructor(t,e){super("tournament-ui"),this.htmlSelected=t,this.htmlDefault=e,this.state={tourneyId:"",isJoined:!1,items:[],nextReset:"",joinFees:[0,1]},this.onTabClickCallback=t=>{this.state.tourneyId=0===t?"FREE_TOURNEY":"PREMIUM_TOURNEY",this.loadTournament()},this.getChild("join-button").on("click",this.onJoinClick.bind(this)),this.getChild("battle-button").on("click",this.onBattleClick.bind(this))}loadTournament(){HomeUi.instance.uiLoading.show(),NetworkManager.instance.getJoinTourney(this.state.tourneyId,(t=>{HomeUi.instance.uiLoading.hide(),this.state.isJoined=t.currentTourneyScores.length>0,this.state.items=t.currentTourneyScores,this.state.nextReset=t.nextReset,this.render(),t.previousTourneyScores.length>0&&(HomeUi.instance.uiPrevTourney.state.cbzRegistration=t.cbzRegistration,HomeUi.instance.uiPrevTourney.state.tourneyId=this.state.tourneyId,HomeUi.instance.uiPrevTourney.state.items=t.previousTourneyScores,HomeUi.instance.uiPrevTourney.show())}),(t=>{HomeUi.instance.uiNetworkError.state.message="Failed to load tournament.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.loadTournament()},HomeUi.instance.uiNetworkError.show()}))}onJoinClick(){HomeUi.instance.uiLoading.show(),this.tryPayFee((t=>{this.networkPostJoinTourney(t)}))}networkPostJoinTourney(t){NetworkManager.instance.postJoinTourney(this.state.tourneyId,t,(t=>{HomeUi.instance.uiLoading.hide(),this.loadTournament()}),(e=>{HomeUi.instance.uiNetworkError.state.message="Failed to save tourney transaction.",HomeUi.instance.uiNetworkError.state.refreshCallback=()=>{this.networkPostJoinTourney(t)},HomeUi.instance.uiNetworkError.show()}))}tryPayFee(t){let e="FREE_TOURNEY"===this.state.tourneyId?"free":"premium",i=this.state.joinFees["FREE_TOURNEY"===this.state.tourneyId?0:1];i>0?SolanaManager.instance.payToken(i,(s=>{NetworkManager.instance.cyberdogzRegister(e,s,i,(e=>{console.log("cbzRegistration",e),t(e)}))}),(t=>{console.log("error",t)})):NetworkManager.instance.cyberdogzRegister(e,null,i,(e=>{console.log("cbzRegistration",e),t(e)}))}onBattleClick(){pc.targetLeaderboards=[this.state.tourneyId],HomeUi.instance.uiBriefing.show()}render(){"FREE_TOURNEY"===this.state.tourneyId?this.state.joinFees[0]:this.state.joinFees[1];this.initializeItems(this.state.items,((t,e)=>{let i=t.playerId==localStorage.getItem("userId")?this.htmlSelected:this.htmlDefault,s=new UI(`item-${e}`,i);return s.getChild("rank-text").text(`${t.rank+1}`),s.getChild("name-text").text(t.playerName),s.getChild("meta-text").text("---"),s.getChild("score-text").text(t.score),s})),this.getChild("join-button").prop("disabled",this.state.isJoined),this.getChild("battle-button").prop("disabled",!this.state.isJoined)}renderEachFrame(t){if(""===this.state.nextReset)return;const e=Math.floor((new Date(this.state.nextReset)-new Date)/1e3);let i="--:--:--";if(e>=0){const t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60,format=t=>t.toString().padStart(2,"0");i=`${format(t)}:${format(s)}:${format(a)}`}this.getChild("time-text").text(i)}}(this.htmlLeaderboardSelectedItem.resource,this.htmlLeaderboardDefaultItem.resource),this.uiPrevTourney=new PreviousTourneyUI,this.uiUpgrade=new UpgradeUI,this.uiTierUp=new TierUpUI,this.uiRarityUp=new RarityUpUI,this.uiShowcase=new ShowcaseUI,this.uiNetworkError=new NetworkErrorUI,this.uiFooter=new FooterUI,this.setupEventListeners(),this.initializeCurrentMap()},HomeUi.prototype.update=function(t){this.uiTournament.renderEachFrame(t)},HomeUi.prototype.setupEventListeners=function(){const t={"#play-button":this.onPlayClick,"#leaderboards-button":this.onLeaderboardsClick,"#tournament-button":this.onTournamentClick};Object.entries(t).forEach((([t,e])=>{$(t).on("click",(t=>e.call(this,t)))}))},HomeUi.prototype.initializeCurrentMap=function(){$("#map-intro-img").attr("src",this.app.assets.get(170607946).getFileUrl())},HomeUi.prototype.onPlayClick=function(t){pc.targetLeaderboards=["ALL_TIME","WEEKLY","DAILY"],this.uiBriefing.show()},HomeUi.prototype.onLeaderboardsClick=function(t){this.uiLeaderboards.show()},HomeUi.prototype.onTournamentClick=function(t){this.uiTournament.show()};var Input=pc.createScript("input");Input.instance=null,Input.attributes.add("cameraEntity",{type:"entity"}),Input.prototype.initialize=function(){Input.instance=this,this.app.mouse&&(this.boundOnMouseDown=this.onMouseDown.bind(this),this.boundOnMouseUp=this.onMouseUp.bind(this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.boundOnMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.boundOnMouseUp,this),this.entity.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.boundOnMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.boundOnMouseUp,this)}),this)),this.app.touch&&(this.boundOnTouchStart=this.onTouchStart.bind(this),this.boundOnTouchMove=this.onTouchMove.bind(this),this.boundOnTouchEnd=this.onTouchEnd.bind(this),this.app.touch.on(pc.EVENT_TOUCHSTART,this.boundOnTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.boundOnTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.boundOnTouchEnd,this),this.entity.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.boundOnTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.boundOnTouchMove,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.boundOnTouchEnd,this)}),this)),this.isMouseDown=!1,this.mousePosition=new pc.Vec2,this.moveDirection=new pc.Vec2},Input.prototype.update=function(t){if(!GameManager.instance.isPaused){var i=this.entity.getPosition();this.app.touch||(this.moveDirection.x=0,this.moveDirection.y=0,this.app.keyboard.isPressed(pc.KEY_A)&&(this.moveDirection.x-=1),this.app.keyboard.isPressed(pc.KEY_D)&&(this.moveDirection.x+=1),this.app.keyboard.isPressed(pc.KEY_W)&&(this.moveDirection.y-=1),this.app.keyboard.isPressed(pc.KEY_S)&&(this.moveDirection.y+=1));var o=this.entity.script.unit.getSpeed(),n=Math.sqrt(this.moveDirection.x*this.moveDirection.x+this.moveDirection.y*this.moveDirection.y);n>0?(this.moveDirection.x=this.moveDirection.x/n*o*t,this.moveDirection.y=this.moveDirection.y/n*o*t):(this.moveDirection.x=0,this.moveDirection.y=0),this.entity.setPosition(i.x-this.moveDirection.x,i.y,i.z-this.moveDirection.y);var s=this.cameraEntity.getPosition(),e=this.entity.getPosition(),h=new pc.Vec3;h.lerp(s,e,.1),h.y=10,this.cameraEntity.setPosition(h)}},Input.prototype.onMouseDown=function(t){this.isMouseDown=!0},Input.prototype.onMouseUp=function(t){this.isMouseDown=!1},Input.prototype.onTouchStart=function(t){var i=t.touches[0];this.touchStart=new pc.Vec2(i.x,i.y),this.isTouching=!0,t.event.preventDefault()},Input.prototype.onTouchMove=function(t){if(this.isTouching){var i=t.touches[0];this.touchMove=new pc.Vec2(i.x,i.y);var o=this.touchMove.clone().sub(this.touchStart);o.normalize(),this.moveDirection=o}},Input.prototype.onTouchEnd=function(t){this.isTouching=!1,this.moveDirection=new pc.Vec2};var EnemyManager=pc.createScript("enemyManager");EnemyManager.instance=null,EnemyManager.attributes.add("playerEntity",{type:"entity"}),EnemyManager.attributes.add("eclipseTreshold",{type:"number"}),EnemyManager.attributes.add("wavesJson",{type:"asset",assetType:"json"}),EnemyManager.prototype.initialize=function(){EnemyManager.instance=this,this.wavesData=this.app.assets.get(this.wavesJson.id).resource,this.currentWave=1,this.waveTimer=0,this.spawnTimer=0,this.isEclipse=!1},EnemyManager.prototype.update=function(e){this.updateEnemies(e),this.updateSpawner(e),this.updateEclipse()},EnemyManager.prototype.updateEnemies=function(e){let t=EnemyPool.instance.activeObjects;if(GameManager.instance.isPaused)for(let e=t.length-1;e>=0;e--)t[e].enabled&&(t[e].script.enemy.spriteEntity.sprite.speed=0);else for(let n=t.length-1;n>=0;n--)if(t[n].enabled){let a=t[n].script.enemy,i=GridManager.instance.getNearbyEntities(t[n]);a.updateCustom(this.isEclipse,this.playerEntity,i,e),a.spriteEntity.sprite.speed=a.entity.script.unit.getSpeed()}},EnemyManager.prototype.getMaxSpawnTimer=function(){const e=-GameManager.instance.time/30;return.5*Math.pow(1.25,e)},EnemyManager.prototype.updateSpawner=function(e){if(!GameManager.instance.isPaused&&(this.waveTimer+=e,this.waveTimer>=this.wavesData.duration&&(this.waveTimer=0,this.spawnTimer=0,this.currentWave+=1),this.spawnTimer+=e,this.spawnTimer>=this.getMaxSpawnTimer())){let e=Math.floor(Math.pow(2,this.currentWave-1));console.log(this.currentWave,e);let t=this.getSpawnVariations(e,this.wavesData.enemies),n=t[Math.floor(Math.random()*t.length)];for(let e=0;e<n.length;e++)this.spawnEnemy(n[e],8);this.spawnTimer=0}},EnemyManager.prototype.getSpawnPosition=function(e){let t=this.playerEntity.getPosition(),n=2*Math.random()*Math.PI,a=e*Math.cos(n),i=e*Math.sin(n),s=t.x+a,r=t.z+i;return new pc.Vec3(s,t.y,r)},EnemyManager.prototype.spawnEnemy=function(e,t){let n=DataManager.instance.getEnemy(e),a=this.app.assets.get(n.id);a.ready((()=>{let e=this.getSpawnPosition(t),i=EnemyPool.instance.spawn(a,e,(e=>{e.script.enemy.initializeCustom(),e.script.unit&&e.script.unit.initializeCustom(n,[])}));i&&GridManager.instance.addEntity(i)}))},EnemyManager.prototype.updateEclipse=function(){this.isEclipse=EnemyPool.instance.activeObjects.length>=this.eclipseTreshold},EnemyManager.prototype.getSpawnVariations=function(e,t){t.sort(((e,t)=>t.weight-e.weight)),this.shuffleSameWeight(t);let n=[];return this.generateVariations(e,t,[],n,0,1),n},EnemyManager.prototype.shuffleSameWeight=function(e){for(let t=0;t<e.length;t++){let n=t,a=t;for(;a<e.length&&e[n].weight===e[a].weight;)a++;for(let t=n;t<a;t++){const i=Math.floor(Math.random()*(a-n))+n;[e[t],e[i]]=[e[i],e[t]]}t=a-1}},EnemyManager.prototype.generateVariations=function(e,t,n=[],a=[],i=0,s=8){if(!(a.length>=s))if(0!==e)for(let r=i;r<t.length;r++){const i=t[r];i.weight<=e&&this.generateVariations(e-i.weight,t,[...n,i.id],a,r,s)}else a.push([...n])};var MetaMaskChecker=pc.createScript("metaMaskChecker");MetaMaskChecker.instance=null,MetaMaskChecker.prototype.initialize=function(){MetaMaskChecker.instance=this},MetaMaskChecker.prototype.initializeMetaMask=async function(e,t){try{let t=new ethers.providers.Web3Provider(window.ethereum);if(137!==(await t.getNetwork()).chainId)return void console.log("Not polygon mainnet");let n=t.getSigner(),a=await n.getAddress(),i=this.getABI(),s="0xcF79651fBae99559127764a5ab808747fa3391ce";new ethers.Contract(s,i,n);e(a)}catch(e){console.error(e)}},MetaMaskChecker.prototype.getERC20Balance=async function(e,t){console.log("getERC20Balance",e,t);try{let n=await e.balanceOf(t);return console.log("Not parsed to float balance",n),parseFloat(ethers.utils.formatEther(n))}catch(e){console.log("getERC20Balance error"),console.error(e)}return console.log("If this happen, then it failed getting real value"),0},MetaMaskChecker.prototype.getCurrentBlock=async function(){try{const e=await this.provider.getBlockNumber();console.log("Current block number:",e)}catch(e){console.error("Error getting block number:",e)}},MetaMaskChecker.prototype.getABI=function(){return[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Paused",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"token",type:"address"},{indexed:!0,internalType:"address",name:"destination",type:"address"},{indexed:!0,internalType:"uint256",name:"amount",type:"uint256"}],name:"RecoverToken",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Unpaused",type:"event"},{inputs:[],name:"MAX_CAP",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"burnFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"governance",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"address",name:"destination",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"recoverToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_governance",type:"address"}],name:"setGovernance",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"}]};var Enemy=pc.createScript("enemy");Enemy.attributes.add("spriteEntity",{type:"entity"}),Enemy.attributes.add("soundEntity",{type:"entity"}),Enemy.prototype.initializeCustom=function(){this.entity.rigidbody.group=pc.BODYGROUP_USER_2,this.entity.rigidbody.mask=pc.BODYGROUP_USER_1|pc.BODYGROUP_USER_3,this.frameCounter=Math.floor(2*Math.random())},Enemy.prototype.updateCustom=function(t,e,i,n){let s=e.getPosition().clone().sub(this.entity.getPosition()).normalize(),o=this.entity.script.unit.getSpeed()*(t?2:1);if(this.entity.script.unit.isDestroyed){let t=s.clone().scale(-3*n);this.entity.translate(t.x,0,t.z),GridManager.instance.updateEntityPosition(this.entity)}else{let a=s.clone().scale(o*n);this.updatePosition(i,s,o,n),this.updateFacing(a),this.updateMeleeAttack(t,e,n)}},Enemy.prototype.updatePosition=function(t,e,i,n){if(this.frameCounter++,this.frameCounter%2!=0)return;this.frameCounter=0,n*=2;let s=1/0,o=new pc.Vec3;for(let n=0;n<t.length;n++){let a=t[n];if(a===this.entity)continue;o.copy(a.getPosition()).sub(this.entity.getPosition());let r=o.lengthSq();if(e.dot(o)>0&&r<s&&(s=r,r<=.25)){i=0;break}}let a=e.clone().scale(i*n);this.entity.translate(a.x,0,a.z),GridManager.instance.updateEntityPosition(this.entity)},Enemy.prototype.updateMeleeAttack=function(t,e,i){let n=e.getPosition();if(this.entity.getPosition().distance(n)<=1){let n=this.entity.script.unit.getAttack()*(t?2:1)*i;e.script.unit.damageHealth(n,this.entity,1)}},Enemy.prototype.updateFacing=function(t){if(!this.spriteEntity)return;let e=this.spriteEntity.getLocalScale();e.x=t.x>0?1:-1,this.spriteEntity.setLocalScale(e)};var Player=pc.createScript("player");Player.instance=null,Player.attributes.add("weaponPivot",{type:"entity"}),Player.attributes.add("weaponPivots",{type:"entity",array:!0}),Player.attributes.add("spriteEntity",{type:"entity"}),Player.attributes.add("jsonData",{type:"asset",assetType:"json"}),Player.prototype.initialize=function(){Player.instance=this;let t=this.app.assets.get(this.jsonData.id).resource;this.upgrades={},this.stats={exp:0,kibblez:0,level:1,surge:0,bonusScore:0},this.isSurge=!1,this.initializeWeapons(pc.weapons),this.entity.script.unit.initializeCustom(t),this.entity.rigidbody.group=pc.BODYGROUP_USER_1,this.entity.rigidbody.mask=pc.BODYGROUP_USER_2|pc.BODYGROUP_USER_4,this.facingDirection=new pc.Vec2,this.weaponDirection=new pc.Vec2},Player.prototype.initializeWeapons=function(t){this.weapons=[];for(let e=0;e<t.length;e++){let a=t[e],i=a.instanceData.id,n={id:i,data:DataManager.instance.getWeapon(i),ugsData:a,level:0,cooldown:0,barrageCount:0,isUnlocked:0===e,upgrades:{},damageDealt:0,damageRate:1+.05*(pc.app.getLevelByExp(a.instanceData.exp)-1)};this.upgradeWeapon(n),this.weapons.push(n),this.initializeWeaponEntity(n,this.weaponPivots[e])}GameUi.instance.updateWeapons(this.weapons)},Player.prototype.initializeWeaponEntity=function(t,e){const a=this.app.assets.get(t.id);a.ready((()=>{var t=a.resource.instantiate();e.addChild(t)}))},Player.prototype.update=function(t){GameManager.instance.isPaused||(this.updateFacing(),this.updateMaxBounds(),this.updateSurge(t),this.updateWeaponVisibility(),this.updateWeaponsCooldown(t),this.updateWeaponsFacing(t),this.updateWeaponsShooting(),this.entity.script.unit.updateCustom(t))},Player.prototype.updateFacing=function(){0===Input.instance.moveDirection.x&&0===Input.instance.moveDirection.y||this.facingDirection.set(Input.instance.moveDirection.x,Input.instance.moveDirection.y);let t=this.spriteEntity.getLocalScale();t.x=this.facingDirection.x>0?-1:1,this.spriteEntity.setLocalScale(t)},Player.prototype.updateMaxBounds=function(){let t=this.entity.getPosition().clone(),e=t.length(),a=MapManager.instance.mapRadius;if(e>a){var i=t.normalize().scale(a);this.entity.setPosition(i)}},Player.prototype.updateSurge=function(t){this.isSurge&&(this.stats.surge=Math.max(0,this.stats.surge-4*t),this.stats.surge<=0&&(this.isSurge=!1))},Player.prototype.updateWeaponVisibility=function(){for(let t=0;t<this.weapons.length;t++){const e=this.weapons[t];this.weaponPivots[t].enabled=e.isUnlocked}},Player.prototype.updateWeaponsShooting=function(){for(let t=0;t<this.weapons.length;t++){const e=this.weapons[t],a=this.getWeaponBarrageCount(e),i=1/this.getWeaponFireRate(e),n=i/4;let s=this.weaponPivots[t].children[0],o=s.script.weapon;if(e.cooldown>=n&&e.barrageCount<a){const a=o.muzzle.getPosition(),i=this.weaponPivots[t].getRotation();this.shootBullets(e,a,i),e.cooldown=0,e.barrageCount+=1,s.script.cdsEntity.setTemporaryClip("Clip 2",100)}if(e.cooldown>=i){const a=o.muzzle.getPosition(),i=this.weaponPivots[t].getRotation();this.shootBullets(e,a,i),e.cooldown=0,e.barrageCount=0,s.script.cdsEntity.setTemporaryClip("Clip 2",100)}}},Player.prototype.updateWeaponsCooldown=function(t){for(let e=0;e<this.weapons.length;e++){const a=this.weapons[e];a.isUnlocked&&(a.cooldown+=t)}},Player.prototype.updateWeaponsFacing=function(){0===Input.instance.moveDirection.x&&0===Input.instance.moveDirection.y||this.weaponDirection.set(Input.instance.moveDirection.x,Input.instance.moveDirection.y);for(let t=0;t<this.weapons.length;t++){let e=this.weapons[t],a=this.weaponPivots[t].children[0];if(this.hasUpgrade(e,"aim_nearest")||this.hasUpgrade(e,"aim_random")){let i=EnemyPool.instance.activeObjects,n=null;if(this.hasUpgrade(e,"aim_nearest")){let t=1/0;i.forEach((e=>{let i=e.getPosition(),s=a.getPosition().distance(i);s<t&&(t=s,n=e)}))}else if(this.hasUpgrade(e,"aim_random")){let t=1/this.getWeaponFireRate(e);e.cooldown>=t&&(n=0===i.length?null:i[Math.floor(Math.random()*i.length)])}if(n){let e=new pc.Vec3;e.sub2(n.getPosition(),a.getPosition()),e.x=-e.x;let i=180*Math.atan2(e.z,e.x)/Math.PI+90;this.weaponPivots[t].setEulerAngles(0,i,0)}}else if(this.hasUpgrade(e,"aim_manual")){let e=0;e=Math.atan2(this.weaponDirection.y,this.weaponDirection.x)*(180/Math.PI)-90,e<0&&(e+=360),e=-e,this.weaponPivots[t].setEulerAngles(0,e,0)}const i=a.getLocalScale();i.x=this.isRightSide(this.weaponPivots[t].getEulerAngles().y)?-1:1,a.setLocalScale(i)}},Player.prototype.isRightSide=function(t){var e=t%360;return e<0&&(e+=360),e<=180},Player.prototype.getWeapon=function(t){return t<this.weapons.length?this.weapons[t]:null},Player.prototype.hasUpgrade=function(t,e){return t.upgrades[e]},Player.prototype.shootBullets=function(t,e,a){let i=this.getWeaponBulletCount(t),n=this.getWeaponBarrelCount(t),s=this.is360Shot(t);for(let o=0;o<i;o++)for(let r=0;r<n;r++){let p,l=new pc.Vec3(.5*r-.5*(n-1)/2,0,0),u=a.getEulerAngles(),c=Math.random()*(2*t.data.spreadAngle)-t.data.spreadAngle;p=s?360/i*o:8*o-8*(i-1)/2;let h=new pc.Quat;h.setFromEulerAngles(u.x,u.y+c+p,u.z);let g=h.transformVector(l,new pc.Vec3),d=e.clone().add(g);this.shootBullet(t,d,h)}let o=1/t.data.fireRate*.0625;ShakeScreen.instance.shake(o,.125)},Player.prototype.shootBullet=function(t,e,a){var i=this.app.assets.get(t.data.bulletId);i.ready((()=>{let n=DataManager.instance.getBullet(t.data.bulletId);BulletPool.instance.spawn(i,e,(e=>{e.setRotation(a),e.script.bullet.initializeStats(n,t,this.entity)}))}))},Player.prototype.applyUpgrade=function(upgrade){let player=this,unit=this.entity.script.unit;if(upgrade.effects&&(upgrade.effects.forEach((t=>{let e=upgrade.isWeaponUpgrade?this.getWeapon(upgrade.weaponIndex):player,a=t.keys.length-1,i=t.keys[a],n=t.keys.slice(0,a).reduce(((t,e)=>(void 0===t[e]&&(t[e]={}),t[e])),e);t.multiply&&(n[i]=(n[i]||1)*t.multiply),t.add&&(n[i]=(n[i]||0)+t.add),t.value&&(n[i]=t.value)})),GameUi.instance.updateWeapons(this.weapons)),upgrade.setEffects){let weapon=this.getWeapon(upgrade.weaponIndex);upgrade.setEffects.forEach((setEffect=>{eval(setEffect)})),GameUi.instance.updateWeapons(player.weapons)}unit.healHealth(unit.getMaxHealth())},Player.prototype.upgradeWeapon=function(t){let e=t.data.upgradesPerLevel;if(t.level>=e.length)return;const a=e[t.level];for(const e in a)t.upgrades[e]=(t.upgrades[e]||0)+a[e];t.level+=1},Player.prototype.addItem=function(t,e){this.stats[t]+=e;var a=this.getMaxExp();this.stats.exp>=a&&this.levelUp(),GameUi.instance.updateExpLevel(this.stats.exp,a,this.stats.level),GameUi.instance.updateKibblez(this.stats.kibblez)},Player.prototype.getExp=function(){return this.stats.exp},Player.prototype.getMaxExp=function(){return 10*Math.pow(1.1,this.stats.level-1)},Player.prototype.getKibblez=function(){return this.stats.kibblez},Player.prototype.getLevel=function(){return this.stats.level},Player.prototype.levelUp=function(){this.stats.exp=0,this.stats.level+=1,GameUi.instance.showLevelUp(DataManager.instance.getRandomUpgrades(this,3))},Player.prototype.getSurge=function(){return this.stats.surge},Player.prototype.getMaxSurge=function(){return 128},Player.prototype.addSurge=function(t){let e=t+t*(this.upgrades.surge_gain||0)*.25;this.stats.surge=Math.min(this.stats.surge+e,this.getMaxSurge()),this.stats.surge>=this.getMaxSurge()&&(this.isSurge=!0)},Player.prototype.getScoreBoost=function(){return 1+.05*(this.upgrades.score_boost||0)},Player.prototype.getWeaponAttack=function(t){let e=1+(t.upgrades.damage_rate||0)+(this.isSurge?1:0);return this.entity.script.unit.getAttack()*t.data.damageRate*e},Player.prototype.getWeaponFireRate=function(t){let e=1+(t.upgrades.fire_rate||0)+(this.isSurge?1:0);return t.data.fireRate*e},Player.prototype.getWeaponBulletSpeed=function(t){let e=DataManager.instance.getBullet(t.data.bulletId),a=1+(t.upgrades.bullet_speed||0);return e.speed*a},Player.prototype.getWeaponBulletCount=function(t){return 1+(t.upgrades.bullet_count||0)},Player.prototype.getWeaponBulletDuration=function(t){let e=DataManager.instance.getBullet(t.data.bulletId),a=1+(t.upgrades.bullet_duration||0);return e.time*a},Player.prototype.getWeaponBarrelCount=function(t){return 1+(t.upgrades.barrel_count||0)},Player.prototype.getWeaponBarrageCount=function(t){return 0+(t.upgrades.barrage_count||0)},Player.prototype.is360Shot=function(t){return t.upgrades["360_shot"]};var Bullet=pc.createScript("bullet");Bullet.attributes.add("spriteEntities",{type:"entity",array:!0}),Bullet.prototype.initialize=function(){this.boundOnCollisionStart=this.onCollisionStart.bind(this),this.entity.collision.on("collisionstart",this.boundOnCollisionStart,this)},Bullet.prototype.destroyListeners=function(){this.entity.collision.off("collisionstart",this.boundOnCollisionStart,this)},Bullet.prototype.initializeStats=function(t,e,i){this.data=t,this.weapon=e,this.owner=i,this.time=0;for(let i=0;i<this.spriteEntities.length;i++){let s=this.spriteEntities[i],n=e.upgrades.damage_rate||0,o=t.sprites[n];s.sprite.spriteAsset=this.app.assets.get(o),s.sprite.opacity=1}i.script.player?(this.entity.rigidbody.group=pc.BODYGROUP_USER_3,this.entity.rigidbody.mask=pc.BODYGROUP_USER_2):i.script.enemy&&(this.entity.rigidbody.group=pc.BODYGROUP_USER_4,this.entity.rigidbody.mask=pc.BODYGROUP_USER_1),this.initilizeSize()},Bullet.prototype.initilizeSize=function(){if(!this.weapon.upgrades.bullet_size)return;let t=this.entity.collision,e=(this.weapon.upgrades.bullet_size||0)+1,i=t.halfExtents.clone();i.x=.125*e,t.halfExtents=i;for(let t=0;t<this.spriteEntities.length;t++){let i=this.spriteEntities[t];i.setLocalScale(e,e,1),i.sprite.height=10/e}},Bullet.prototype.updateCustom=function(t){let e=this.owner.script.player.getWeaponBulletSpeed(this.weapon),i=this.owner.script.player.getWeaponBulletDuration(this.weapon),s=this.entity.forward.clone().scale(e*t);if(this.entity.translate(s),this.time+=t,this.data.fadeDuration)for(let t=0;t<this.spriteEntities.length;t++)this.spriteEntities[t].sprite.opacity=1-this.time/this.data.fadeDuration;this.weapon.upgrades.homing&&this.onUpdateDirection(t),this.weapon.upgrades.screen_boomerang&&this.onUpdateScreenBoomerang(),this.weapon.upgrades.screen_mirror&&this.onUpdateScreenMirror(),this.time>=i&&BulletPool.instance.despawn(this.entity)},Bullet.prototype.onUpdateDirection=function(t){let e=EnemyPool.instance.activeObjects,i=null,s=1/0;if(e.forEach((t=>{let e=t.getPosition(),n=this.entity.getPosition().distance(e);n<s&&(s=n,i=t)})),i){let e=new pc.Vec3;e.sub2(i.getPosition(),this.entity.getPosition()),e.x=-e.x;let s=Math.atan2(e.z,e.x)*pc.math.RAD_TO_DEG+90,n=s-this.entity.getEulerAngles().y;n=(n+180)%360-180;let o=360*t;Math.abs(n)<o?this.entity.setEulerAngles(0,s,0):this.entity.rotate(0,Math.sign(n)*o,0)}},Bullet.prototype.onUpdateScreenBoomerang=function(){var t=Input.instance.cameraEntity,e=t.camera,i=2*e.orthoHeight,s=i*e.aspectRatio,n=this.entity.getPosition(),o=t.getPosition(),l=o.x-s/2,a=o.x+s/2,r=o.z-i/2,p=o.z+i/2;if(n.x<=l||n.x>=a||n.z<=r||n.z>=p){var h=this.entity.getEulerAngles();this.entity.setEulerAngles(h.x,h.y+180,h.z)}},Bullet.prototype.onUpdateScreenMirror=function(){var t=Input.instance.cameraEntity,e=t.camera,i=2*e.orthoHeight,s=i*e.aspectRatio,n=this.entity.getPosition(),o=t.getPosition(),l=o.x-s/2,a=o.x+s/2,r=o.z-i/2,p=o.z+i/2;let h=null;if(n.x<=l?h="left":n.x>=a?h="right":n.z<=r?h="bottom":n.z>=p&&(h="top"),h){let t=this.entity.getEulerAngles().y,e=this.calculateNewYAngle(t,h);console.log(`Side Hit: ${h}, Current Y Angle: ${t}, New Y Angle: ${e}`),this.entity.setLocalEulerAngles(0,e,0)}},Bullet.prototype.calculateNewYAngle=function(t,e){let i=t%360;i<0&&(i+=360);let s=i;switch(e){case"left":case"right":s=360-i;break;case"top":case"bottom":s=i<=180?180-i:540-i}return s%=360,s},Bullet.prototype.onCollisionStart=function(t){let e=t.other,i=this.owner.script.player.getWeaponAttack(this.weapon)*(this.data.isPellet?.25:1),s=!1;e.script&&e.script.unit&&!e.script.unit.isDestroyed&&(this.weapon.damageDealt+=Math.min(i,e.script.unit.getHealth()),e.script.unit.damageHealth(i),s=!0),this.weapon.upgrades.pellets&&!this.data.isPellet&&this.onSpawnPellets(),!this.weapon.upgrades.pass_through&&s&&BulletPool.instance.despawn(this.entity)},Bullet.prototype.onSpawnPellets=function(){let t=170951732;var e=this.app.assets.get(t);e.ready((()=>{let i=DataManager.instance.getBullet(t),s=this.entity.getPosition(),n=this.entity.getEulerAngles();for(let t=0;t<6;t++){let o=new pc.Quat;o.setFromEulerAngles(n.x,n.y+60*t,n.z),BulletPool.instance.spawn(e,s,(t=>{t.setRotation(o),t.script.bullet.initializeStats(i,this.weapon,this.owner)}))}}))};var BulletManager=pc.createScript("bulletManager");BulletManager.instance=null,BulletManager.prototype.initialize=function(){BulletManager.instance=this},BulletManager.prototype.destroyListeners=function(){for(var e=BulletPool.instance.activeObjects,t=0;t<e.length;t++)e[t].script.bullet.destroyListeners()},BulletManager.prototype.update=function(e){if(!GameManager.instance.isPaused)for(var t=BulletPool.instance.activeObjects,a=0;a<t.length;a++){if(t[a].enabled)t[a].script.bullet.updateCustom(e)}};var GameManager=pc.createScript("gameManager");GameManager.instance=null,GameManager.prototype.initialize=function(){GameManager.instance=this,this.isPaused=!1,this.kills=0,this.time=0,this.playerTimeScale=1,this.enemyTimeScale=1,this.states=[],localStorage.getItem("isGameTutorialDone")||(localStorage.setItem("isGameTutorialDone",!0),this.isPaused=!0,GameUi.instance.uiTutorial.show())},GameManager.prototype.update=function(e){this.isPaused||(this.time+=e,this.updateStates(e),GameUi.instance.updateTime(this.time))},GameManager.prototype.updateStates=function(e){for(let t=this.states.length-1;t>=0;t--){var a=this.states[t];a.duration-=e,a.duration<=0&&(this[a.variable]=a.defaultValue,this.states.splice(t,1))}},GameManager.prototype.addKill=function(e){this.kills+=e,GameUi.instance.updateKills(this.kills)},GameManager.prototype.showGameOver=function(){this.isPaused=!0,GameUi.instance.showGameOver()};var Drops=pc.createScript("drops");Drops.prototype.initializeCustom=function(t){this.data=t,this.velocity=-8,this.maxVelocity=32,this.acceleration=32,this.isDrawn=!1,this.mapCenter=new pc.Vec3},Drops.prototype.updateCustom=function(t){let i=Player.instance,e=i.entity;var s=e.getPosition(),o=this.entity.getPosition().distance(s);this.updateDrawEffect(e,o,t),this.updateCollisionToPlayer(i,o)},Drops.prototype.updateDrawEffect=function(t,i,e){let s=i<=t.script.unit.getPickRange();if(this.mapCenter.distance(this.entity.getPosition())>=.95*MapManager.instance.mapRadius){this.velocity=8;var o=this.entity.getPosition();(c=this.mapCenter.clone().sub(o)).normalize();var a=this.velocity*e,n=c.scale(a),r=o.add(n);this.entity.setPosition(r)}if(s||this.isDrawn){this.velocity=Math.min(this.velocity+this.acceleration*e,this.maxVelocity);o=this.entity.getPosition();var c,h=(c=t.getPosition().clone().sub(o)).length();if(h>0){c.normalize();a=Math.min(h,this.velocity*e),n=c.scale(a),r=o.add(n);this.entity.setPosition(r)}this.isDrawn=!0}},Drops.prototype.updateCollisionToPlayer=function(t,i){i<=.5&&(DropsPool.instance.despawn(this.entity),t.addItem(this.data.key,this.data.value))};var DropsManager=pc.createScript("dropsManager");DropsManager.instance=null,DropsManager.prototype.initialize=function(){DropsManager.instance=this},DropsManager.prototype.update=function(e){if(GameManager.instance.isPaused)return;let a=DropsPool.instance.activeObjects;for(let n=0;n<a.length;n++)if(a[n].enabled){a[n].script.drops.updateCustom(e)}};var EnemyPool=pc.createScript("enemyPool");EnemyPool.instance=this,EnemyPool.prototype.initialize=function(){EnemyPool.instance=this,this.maxCount=500,this.activeObjects=[],this.inactiveObjects={},this.currentId=0,this.spawnCounter=0,this.despawnCounter=0},EnemyPool.prototype.spawn=function(t,e,i){if(this.activeObjects.length<this.maxCount){null!=this.inactiveObjects[t.name]&&0!=this.inactiveObjects[t.name].length||this.createAndAddToInactiveObjects(t);var n=this.inactiveObjects[t.name].pop();return n.id=this.currentId,n.setPosition(e),this.activeObjects.push(n),i(n),n.enabled=!0,this.currentId+=1,this.spawnCounter+=1,n}return null},EnemyPool.prototype.despawn=function(t){this.inactiveObjects[t.name].push(t);var e=this.activeObjects.findIndex((e=>e.id===t.id));e>-1&&(this.activeObjects.splice(e,1),t.enabled=!1,this.despawnCounter+=1)},EnemyPool.prototype.createAndAddToInactiveObjects=function(t){var e=t.resource.instantiate();this.app.root.addChild(e),e.name=t.name,e.enabled=!1,this.inactiveObjects[t.name]||(this.inactiveObjects[t.name]=[]),this.inactiveObjects[t.name].push(e)};var Unit=pc.createScript("unit");Unit.prototype.initializeCustom=function(t){this.data=t,this.stats={health:this.data.health,maxHealth:this.data.health,luck:this.data.luck,pickRange:this.data.pickRange},this.isDestroyed=!1},Unit.prototype.updateCustom=function(t){this.healHealth(this.getRegen()*t)},Unit.prototype.isRightSide=function(t){var e=t%360;return e<0&&(e+=360),e<=180},Unit.prototype.getGun=function(t){return t<this.guns.length?this.guns[t]:null},Unit.prototype.hasUpgrade=function(t,e){return t.upgrades[e]},Unit.prototype.spawnDrops=function(t){for(let e=0;e<t.drops.length;e++){let i=t.drops[e];if(Math.random()<=i.chance){let t=this.app.assets.get(i.id);t.ready((()=>{let e=this.entity.getPosition(),s=1*(Math.random()-.5),n=1*(Math.random()-.5),a=new pc.Vec3(e.x+s,e.y,e.z+n);DropsPool.instance.spawn(t,a,(t=>{let e=DataManager.instance.getDrop(i.id);t.script.drops.initializeCustom(e)}))}))}}},Unit.prototype.healHealth=function(t){this.updateHealth(this.stats.health+t)},Unit.prototype.damageHealth=function(t){if(this.isDestroyed)return;this.updateHealth(this.stats.health-t);let e=this.stats.health<=0;this.entity.script.enemy&&(this.entity.script.cdsEntity.setTemporaryClip("Clip 2",100),e||this.entity.script.enemy.soundEntity.sound.slot("Hit").play()),e&&(this.entity.script.player&&GameManager.instance.showGameOver(),this.entity.script.enemy&&(this.entity.script.enemy.soundEntity.sound.slot("Death").play(),this.entity.script.cdsEntity.setTemporaryFade(125),setTimeout((()=>{EnemyPool.instance.despawn(this.entity),GridManager.instance.removeEntity(this.entity,this.entity.oldPosition.x,this.entity.oldPosition.z),GameManager.instance.addKill(1),this.spawnDrops(this.entity.script.unit.data)}),125)),this.isDestroyed=!0)},Unit.prototype.updateHealth=function(t){this.stats.health=Math.min(Math.max(t,0),this.getMaxHealth()),this.entity.script.player&&GameUi.instance.updateHealth(this.stats.health,this.getMaxHealth())},Unit.prototype.getHealth=function(){return this.stats.health},Unit.prototype.getMaxHealth=function(){let t=this.stats.maxHealth,e=0;return this.entity.script.player&&(e=this.entity.script.player.upgrades.max_health||0,e+=this.entity.script.player.isSurge?1:0),t+t*e*.5},Unit.prototype.getLuck=function(){return this.stats.luck},Unit.prototype.getPickRange=function(){let t=this.data.pickRange,e=0;return this.entity.script.player&&(e=this.entity.script.player.upgrades.pick_range||0,e+=this.entity.script.player.isSurge?1:0),t+t*e*.5},Unit.prototype.getAttack=function(){return this.data.attack},Unit.prototype.getSpeed=function(){let t=this.data.speed,e=0;return this.entity.script.player&&(e=this.entity.script.player.upgrades.speed||0,e+=this.entity.script.player.isSurge?1:0),t+t*e*.25},Unit.prototype.getRegen=function(){let t=0;return this.entity.script.player&&(t=this.entity.script.player.upgrades.regenerate||0,t+=this.entity.script.player.isSurge?1:0),.25*t};var BulletPool=pc.createScript("bulletPool");BulletPool.instance=null,BulletPool.prototype.initialize=function(){BulletPool.instance=this,this.maxCount=1e3,this.activeObjects=[],this.inactiveObjects={}},BulletPool.prototype.spawn=function(t,e,i){if(this.activeObjects.length<this.maxCount){null!=this.inactiveObjects[t.name]&&0!=this.inactiveObjects[t.name].length||this.createAndAddToInactiveObjects(t);var n=this.inactiveObjects[t.name].pop();return n.enabled=!0,n.setPosition(e),this.activeObjects.push(n),i(n),n}return null},BulletPool.prototype.despawn=function(t){t.enabled=!1,this.inactiveObjects[t.name].push(t);var e=this.activeObjects.indexOf(t);e>-1&&this.activeObjects.splice(e,1)},BulletPool.prototype.createAndAddToInactiveObjects=function(t){var e=t.resource.instantiate();this.app.root.addChild(e),e.name=t.name,e.enabled=!1,this.inactiveObjects[t.name]||(this.inactiveObjects[t.name]=[]),this.inactiveObjects[t.name].push(e)};var Weapon=pc.createScript("weapon");Weapon.attributes.add("muzzle",{type:"entity"});var HomeManager=pc.createScript("homeManager");HomeManager.instance=null,HomeManager.prototype.initialize=function(){HomeManager.instance=this,this.currencies=[]};var LoadUi=pc.createScript("loadUi");LoadUi.instance=null,LoadUi.attributes.add("globalCssAsset",{type:"asset",assetType:"css"}),LoadUi.attributes.add("htmlAsset",{type:"asset",assetType:"html"}),LoadUi.attributes.add("cssAsset",{type:"asset",assetType:"css"}),LoadUi.prototype.initialize=function(){LoadUi.instance=this,$("head").append('<style id="global-css">'+this.globalCssAsset.resource+"</style>"),$("head").append('<style id="load-ui-css">'+this.cssAsset.resource+"</style>"),$("body").append('<div id="load-ui-html">'+this.htmlAsset.resource+"</div>"),$("#show-signup-button").on("click",this.onShowSignUp.bind(this)),$("#back-button").on("click",this.onBackButtonClick.bind(this)),$("#signup-button").on("click",this.onSignUpClick.bind(this)),$("#signin-button").on("click",this.onSignInClick.bind(this)),$("#google-button").on("click",this.onGoogleClick.bind(this)),$("#apple-button").on("click",this.onAppleClick.bind(this)),$("#guest-button").on("click",this.onGuestClick.bind(this)),$("#phantom-button").on("click",this.onPhantomClick.bind(this)),$("#no-phantom-button").on("click",this.onNoPhantomClick.bind(this)),$("#load-ui #title-img").attr("src",this.app.assets.get(170451432).getFileUrl()),$("#auth-ui #title-img").attr("src",this.app.assets.get(170451432).getFileUrl()),this.uiLoading=new pc.LoadingUI},LoadUi.prototype.onShowSignUp=function(){SoundManager.instance.play("Open UI"),$("#signin-ui").hide(),$("#signup-ui").show()},LoadUi.prototype.onBackButtonClick=function(){SoundManager.instance.play("Close UI"),$("#signup-ui").hide(),$("#signin-ui").show()},LoadUi.prototype.onSignUpClick=function(){let e=$("#reg-username").val(),t=$("#reg-password").val(),o=$("#reg-confirm-password").val(),i=function validateUsername(e){let t=null;return e.length<3?t="Minimum 3 characters required.":e.length>20?t="Maximum 20 characters allowed.":/^[a-z0-9.\-@_]+$/.test(e)||(t="Invalid characters used."),t}(e),n=function validatePassword(e){let t=null;return e.length<8?t="Minimum 8 characters required.":e.length>30?t="Maximum 30 characters allowed.":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?/[!@#$%^&*(),.?":{}|<>]/.test(e)||(t="At least one symbol required."):t="At least one number required.":t="At least one lowercase letter required.":t="At least one uppercase letter required.",t}(t),s=function validateConfirmPassword(e,t){let o=null;return e!==t&&(o="Passwords do not match."),o}(t,o);i?($("#reg-username-info").show(),$("#reg-username-info-text").text(i)):$("#reg-username-info").hide(),n?($("#reg-password-info").show(),$("#reg-password-info-text").text(n)):$("#reg-password-info").hide(),s?($("#reg-confirm-password-info").show(),$("#reg-confirm-password-info-text").text(s)):$("#reg-confirm-password-info").hide(),i||n||s||(this.uiLoading.show(),NetworkManager.instance.signUp(e,t,(e=>{this.uiLoading.hide(),SoundManager.instance.play("Close UI"),localStorage.setItem("idToken",e.idToken),localStorage.setItem("sessionToken",e.sessionToken),localStorage.setItem("userId",e.userId),$("#signup-ui").hide(),$("#phantom-ui").show()})))},LoadUi.prototype.onSignInClick=function(){let e=$("#username").val(),t=$("#password").val(),o=function validateUsername(e){let t=null;return e.length<1&&(t="Field is empty"),t}(e),i=function validatePassword(e){let t=null;return e.length<1&&(t="Field is empty"),t}(t);o?($("#username-info").show(),$("#username-info-text").text(o)):$("#username-info").hide(),i?($("#password-info").show(),$("#password-info-text").text(i)):$("#password-info").hide(),o||i||(this.uiLoading.show(),NetworkManager.instance.signIn(e,t,(e=>{this.uiLoading.hide(),SoundManager.instance.play("Close UI"),localStorage.setItem("idToken",e.idToken),localStorage.setItem("sessionToken",e.sessionToken),localStorage.setItem("userId",e.userId),$("#signin-ui").hide(),$("#phantom-ui").show()}),(e=>{this.uiLoading.hide(),$("#username-info").show(),$("#username-info-text").text("Username may be incorrect"),$("#password-info").show(),$("#password-info-text").text("Password may be incorrect")})))},LoadUi.prototype.onGoogleClick=function(){this.uiLoading.show(),GoogleLogin.instance.onLoginClick((()=>{NetworkManager.instance.signInWithGoogleToken((e=>{this.uiLoading.hide(),localStorage.setItem("idToken",e.idToken),localStorage.setItem("sessionToken",e.sessionToken),localStorage.setItem("userId",e.userId),this.loadNextScene()}))}))},LoadUi.prototype.onAppleClick=function(){this.uiLoading.show(),NetworkManager.instance.signInWithAppleToken((e=>{this.uiLoading.hide(),localStorage.setItem("idToken",e.idToken),localStorage.setItem("sessionToken",e.sessionToken),localStorage.setItem("userId",e.userId),this.loadNextScene()}))},LoadUi.prototype.onGuestClick=function(){const e=localStorage.getItem("idToken");localStorage.removeItem("walletId"),e?this.autoSignIn():(this.uiLoading.show(),NetworkManager.instance.anonymousSignUp((e=>{this.uiLoading.hide(),localStorage.setItem("idToken",e.idToken),localStorage.setItem("sessionToken",e.sessionToken),localStorage.setItem("userId",e.userId),this.loadNextScene()})))},LoadUi.prototype.autoSignIn=function(){this.uiLoading.show(),NetworkManager.instance.signInSessionToken((e=>{this.uiLoading.hide(),localStorage.setItem("idToken",e.idToken),localStorage.setItem("sessionToken",e.sessionToken),localStorage.setItem("userId",e.userId),this.loadNextScene()}))},LoadUi.prototype.onPhantomClick=function(){SolanaManager.instance.login((()=>{$("#load-ui").hide(),$("#auth-ui").show()}),(e=>{console.log(e)}))},LoadUi.prototype.onNoPhantomClick=function(){localStorage.removeItem("walletId"),this.loadNextScene()},LoadUi.prototype.loadNextScene=function(){this.uiLoading.show(),NetworkManager.instance.postInitializeCustom((e=>{$("#load-ui-css").remove(),$("#load-ui-html").remove(),e.isInitialized?this.loadHomeScene():this.loadGameScene()}),(e=>{}))},LoadUi.prototype.loadHomeScene=function(){this.app.scenes.changeScene("Home")},LoadUi.prototype.loadGameScene=function(){pc.targetLeaderboards=["ALL_TIME","WEEKLY","DAILY"],pc.weapons=[{instanceData:{id:167069595,rarity:1,tier:1,exp:0}},{instanceData:{id:167156796,rarity:1,tier:1,exp:0}},{instanceData:{id:167069594,rarity:1,tier:1,exp:0}}],pc.app.scenes.changeScene("Game")};var NetworkManager=pc.createScript("networkManager");NetworkManager.instance=null,NetworkManager.prototype.initialize=function(){NetworkManager.instance=this,this.urlPlayerAuth="https://player-auth.services.api.unity.com",this.urlCloudSave="https://cloud-save.services.api.unity.com",this.urlEconomy="https://economy.services.api.unity.com",this.urlSocial="https://social.services.api.unity.com",this.urlLeaderboard="https://leaderboards.services.api.unity.com",this.urlCloudCode="https://cloud-code.services.api.unity.com",this.projectId="037e1f99-bc20-4f40-9c24-ba5eae5acef4",this.infuraApiKey="911b09911c4c44c9a09cf016b87a7743"},NetworkManager.prototype.get=function(t,e,o){fetch(t,{method:"GET",headers:this.getHeaders()}).then((t=>t.ok?t.json():(o&&o(t),Promise.reject("Network response was not ok")))).then((t=>{e(t)})).catch((t=>{o&&o(t)}))},NetworkManager.prototype.post=function(t,e,o,n,r){fetch(t,{method:"POST",headers:e,body:JSON.stringify(o)}).then((t=>t.ok?t.json():(r&&r(t),Promise.reject("Network response was not ok")))).then((t=>{n(t)})).catch((t=>{r&&r(t)}))},NetworkManager.prototype.put=function(t,e,o,n,r){fetch(t,{method:"PUT",headers:e,body:JSON.stringify(o)}).then((t=>t.ok?t.json():(r&&r(t),Promise.reject("Network response was not ok")))).then((t=>{n(t)})).catch((t=>{r&&r(t)}))},NetworkManager.prototype.cyberdogzRegister=function(t,e,o,n,r){const a={address:localStorage.getItem("walletId"),feeHash:e,amount:o,mode:t};this.post("https://api.cyberdogz.io/v1/survival/register",{"Content-Type":"application/json"},a,n,r)},NetworkManager.prototype.cyberdogzReward=function(t,e,o,n,r,a,s,i){const p={"Content-Type":"application/json",Authorization:localStorage.getItem("cyberdogzToken")},c={walletAddress:localStorage.getItem("walletId"),signature:e,mode:t,registerId:o,rank:n,rewardAmount:r,points:a};this.post("https://api.cyberdogz.io/v1/survival/reward",p,c,s,i)},NetworkManager.prototype.cyberdogzAuth=function(t,e){this.post("https://api.cyberdogz.io/v1/login",{"Content-Type":"application/json"},{email:"palin@smartchainers.in",password:"£j0Rz~29|wJA"},t,e)},NetworkManager.prototype.anonymousSignUp=function(t,e){const o=`${this.urlPlayerAuth}/v1/authentication/anonymous`,n={"Content-Type":"application/json",ProjectId:this.projectId};this.post(o,n,{},t,e)},NetworkManager.prototype.signUp=function(t,e,o,n){const r=`${this.urlPlayerAuth}/v1/authentication/usernamepassword/sign-up`,a={"Content-Type":"application/json",ProjectId:this.projectId},s={username:t,password:e};this.post(r,a,s,o,n)},NetworkManager.prototype.signInSessionToken=function(t,e){const o=`${this.urlPlayerAuth}/v1/authentication/session-token`,n={"Content-Type":"application/json",ProjectId:this.projectId},r={sessionToken:localStorage.getItem("sessionToken")};this.post(o,n,r,t,e)},NetworkManager.prototype.signInWithGoogleToken=function(t,e){const o=localStorage.getItem("googleToken"),n=`${this.urlPlayerAuth}/v1/authentication/external-token/google.com`,r={"Content-Type":"application/json",ProjectId:this.projectId},a={token:o};this.post(n,r,a,t,e)},NetworkManager.prototype.signInWithAppleToken=function(t,e){const o=localStorage.getItem("appleToken"),n=`${this.urlPlayerAuth}/v1/authentication/external-token/apple.com`,r={"Content-Type":"application/json",ProjectId:this.projectId},a={token:o};this.post(n,r,a,t,e)},NetworkManager.prototype.signIn=function(t,e,o,n){const r=`${this.urlPlayerAuth}/v1/authentication/usernamepassword/sign-in`,a={"Content-Type":"application/json",ProjectId:this.projectId},s={username:t,password:e};this.post(r,a,s,o,n)},NetworkManager.prototype.getLeaderboard=function(t,e,o){const n=`${this.urlLeaderboard}/v1/projects/${this.projectId}/leaderboards/${t}/scores?includeMetadata=true`;this.get(n,e,o)},NetworkManager.prototype.getWeapons=function(t,e,o){const n=localStorage.getItem("userId"),r=`/v2/projects/${this.projectId}/players/${n}/inventory?inventoryItemIds[]=WEAPON&limit=20`,a=`${this.urlEconomy}${null==t?r:t}`;this.get(a,e,o)},NetworkManager.prototype.cloudCode=function(t,e,o,n){const r=`${this.urlCloudCode}/v1/projects/${this.projectId}/scripts/${t}`,a=this.getHeaders();this.post(r,a,e,(t=>o(t.output)),n)},NetworkManager.prototype.postInitializeCustom=function(t,e){this.cloudCode("POST_INITIALIZE",{},t,e)},NetworkManager.prototype.getHome=function(t,e){this.cloudCode("GET_HOME",{},t,e)},NetworkManager.prototype.postJoinTourney=function(t,e,o,n){const r={params:{tourneyId:t,cbzRegistration:e}};this.cloudCode("POST_JOIN_TOURNEY",r,o,n)},NetworkManager.prototype.getJoinTourney=function(t,e,o){const n={params:{tourneyId:t}};this.cloudCode("GET_JOINED_TOURNEY",n,e,o)},NetworkManager.prototype.postConcludeTourney=function(t,e,o){const n={params:{tourneyId:t}};this.cloudCode("POST_CONCLUDE_TOURNEY",n,e,o)},NetworkManager.prototype.postUpgrade=function(t,e,o,n){const r={params:{mainItemId:t,exp:e}};this.cloudCode("POST_UPGRADE",r,o,n)},NetworkManager.prototype.postTierUp=function(t,e,o,n){const r={params:{mainItemId:t,subItemId:e}};this.cloudCode("POST_TIER_UP",r,o,n)},NetworkManager.prototype.postRarityUp=function(t,e,o,n){const r={params:{mainItemId:t,subItemId:e}};this.cloudCode("POST_RARITY_UP",r,o,n)},NetworkManager.prototype.postGame=function(t,e,o,n,r,a,s){const i={params:{kibblez:t,time:Math.floor(e),kills:o,level:n.getLevel(),scoreBoost:n.getScoreBoost(),targetLeaderboards:r}};this.cloudCode("POST_GAME",i,a,s)},NetworkManager.prototype.getHeaders=function(){return{Authorization:"Bearer "+localStorage.getItem("idToken"),"Content-Type":"application/json"}},NetworkManager.prototype.getBalance=function(t,e){const o=t.find((t=>t.currencyId===e));return o?o.balance:0};var GridManager=pc.createScript("gridManager");GridManager.instance=null,GridManager.prototype.initialize=function(){GridManager.instance=this,this.cellSize=1,this.mapSize=100,this.columns=Math.ceil(this.mapSize/this.cellSize),this.rows=Math.ceil(this.mapSize/this.cellSize),this.cells=[];for(let i=0;i<this.columns;i++){this.cells[i]=[];for(let t=0;t<this.rows;t++)this.cells[i][t]=[]}this.offset=Math.floor(this.columns/2)},GridManager.prototype.addEntity=function(i){i.oldPosition=i.getPosition();let t=Math.floor((i.position.x+this.mapSize/2)/this.cellSize),e=Math.floor((i.position.z+this.mapSize/2)/this.cellSize);t>=0&&e>=0&&t<this.columns&&e<this.rows&&this.cells[t][e].push(i)},GridManager.prototype.removeEntity=function(i,t,e){let o=Math.floor((t+this.mapSize/2)/this.cellSize),s=Math.floor((e+this.mapSize/2)/this.cellSize);if(o>=0&&s>=0&&o<this.columns&&s<this.rows){let t=this.cells[o][s].indexOf(i);-1!==t?this.cells[o][s].splice(t,1):(console.log(`Failed to remove entity ${i.name} from (${o}, ${s})`),console.error("Caught an error:","lol"),this.app.scenes.changeScene("Home"))}},GridManager.prototype.updateEntityPosition=function(i){this.removeEntity(i,i.oldPosition.x,i.oldPosition.z),this.addEntity(i)},GridManager.prototype.getNearbyEntities=function(i){let t=[],e=Math.floor((i.position.x+this.mapSize/2)/this.cellSize),o=Math.floor((i.position.z+this.mapSize/2)/this.cellSize);for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){let l=e+i,n=o+s;l>=0&&l<this.columns&&n>=0&&n<this.rows&&(t=t.concat(this.cells[l][n]))}return t};var CdsEntity=pc.createScript("cdsEntity");CdsEntity.attributes.add("spriteEntites",{type:"entity",array:!0}),CdsEntity.attributes.add("audioEntity",{type:"entity"}),CdsEntity.prototype.initialize=function(){this.isGlowing=!1,this.isFading=!1,this.fadeElapsed=0},CdsEntity.prototype.update=function(t){for(let t=0;t<this.spriteEntites.length;t++){let i=this.entity.getLocalScale(),s=-.01*this.entity.getLocalPosition().z/i.z;this.spriteEntites[t].setLocalPosition(0,s,0)}if(this.isFading){this.fadeElapsed+=t;for(let t=0;t<this.spriteEntites.length;t++)this.spriteEntites[t].sprite.opacity=1-this.fadeElapsed/this.fadeTime}},CdsEntity.prototype.setTemporaryClip=function(t,i){if(this.isGlowing)return;let s=[];for(let i=0;i<this.spriteEntites.length;i++)s.push(this.spriteEntites[i].sprite.currentClip.name),this.spriteEntites[i].sprite.play(t);this.isGlowing=!0,setTimeout((()=>{for(let t=0;t<this.spriteEntites.length;t++)this.spriteEntites[t].sprite.play(s[t]);this.isGlowing=!1}),i)},CdsEntity.prototype.setTemporaryFade=function(t){this.isFading||(this.isFading=!0,this.fadeTime=t/1e3,setTimeout((()=>{for(let t=0;t<this.spriteEntites.length;t++)this.spriteEntites[t].sprite.opacity=1;this.isFading=!1,this.fadeElapsed=0}),t))},CdsEntity.prototype.playAudio=function(t){this.audioEntity.sound.slot(t).play()};var MapManager=pc.createScript("mapManager");MapManager.instance=null,MapManager.attributes.add("surgeZonesCount",{type:"number"}),MapManager.attributes.add("surgePlantsCount",{type:"number"}),MapManager.attributes.add("mapRadius",{type:"number"}),MapManager.attributes.add("props",{type:"asset",assetType:"template",array:!0}),MapManager.prototype.initialize=function(){this.initializeProps()},MapManager.prototype.initializeProps=function(){MapManager.instance=this,this.mapData={};let a=[];for(let t=0;t<this.surgeZonesCount;t++){let e,s,i;do{e=this.getRandomNumber(-this.mapRadius,this.mapRadius,.25),s=this.getRandomNumber(-this.mapRadius,this.mapRadius,.25),i=Math.sqrt(e*e+s*s)}while(i>this.mapRadius);a[t]={x:e,z:s}}for(let t=0;t<this.surgePlantsCount;t++){let t,e,s,i=a[Math.floor(Math.random()*a.length)];do{t=i.x+this.getRandomNumber(-2.5,2.5,.25),e=i.z+this.getRandomNumber(-2.5,2.5,.25),s=Math.sqrt(t*t+e*e)}while(this.mapData[t]&&this.mapData[t][e]||s>this.mapRadius);this.mapData[t]||(this.mapData[t]={}),this.mapData[t][e]=!0}for(const a in this.mapData)for(const e in this.mapData[a]){var t=this.props[Math.floor(Math.random()*this.props.length)].resource.instantiate();this.entity.addChild(t),t.setPosition(a,0,e);let s=.25*Math.random()+1,i=Math.random()>.5;t.setLocalScale(s*(i?-1:1),s,s)}},MapManager.prototype.getRandomNumber=function(a,t,e){const s=(t-a)/e+1;return a+Math.floor(Math.random()*s)*e},MapManager.prototype.postUpdate=function(a){for(var t=this.mapRadius,e=[],s=[],i=[1,0,0,1],r=0;r<360;r++){var n=pc.math.DEG_TO_RAD*r,p=Math.cos(n)*t,o=Math.sin(n)*t,h=pc.math.DEG_TO_RAD*(r+1),m=Math.cos(h)*t,u=Math.sin(h)*t;e.push(p,0,o,m,0,u),s.push(...i,...i)}pc.app.drawLineArrays(e,s)};var DropsPool=pc.createScript("dropsPool");DropsPool.instance=null,DropsPool.prototype.initialize=function(){DropsPool.instance=this,this.maxCount=1e3,this.activeObjects=[],this.inactiveObjects={}},DropsPool.prototype.spawn=function(t,e,i){if(this.activeObjects.length<this.maxCount){null!=this.inactiveObjects[t.name]&&0!=this.inactiveObjects[t.name].length||this.createAndAddToInactiveObjects(t);var s=this.inactiveObjects[t.name].pop();return s.enabled=!0,s.setPosition(e),this.activeObjects.push(s),i(s),s}return null},DropsPool.prototype.despawn=function(t){t.enabled=!1,this.inactiveObjects[t.name].push(t);var e=this.activeObjects.indexOf(t);e>-1&&this.activeObjects.splice(e,1)},DropsPool.prototype.createAndAddToInactiveObjects=function(t){var e=t.resource.instantiate();this.app.root.addChild(e),e.name=t.name,e.enabled=!1,this.inactiveObjects[t.name]||(this.inactiveObjects[t.name]=[]),this.inactiveObjects[t.name].push(e)};var SoundManager=pc.createScript("soundManager");SoundManager.instance=null,SoundManager.prototype.initialize=function(){SoundManager.instance=this},SoundManager.prototype.play=function(n){this.entity.sound.slot(n).play()};var ShakeScreen=pc.createScript("shakeScreen");ShakeScreen.instance=null,ShakeScreen.prototype.initialize=function(){ShakeScreen.instance=this,this.shaking=!1},ShakeScreen.prototype.update=function(i){if(this.shaking)if(this.timer-=i,this.timer<=0)this.shaking=!1,this.entity.setPosition(this.originalPosition);else{var t=this.originalPosition.x+(Math.random()-.5)*this.intensity,n=this.originalPosition.y,e=this.originalPosition.z+(Math.random()-.5)*this.intensity;this.entity.setPosition(t,n,e)}},ShakeScreen.prototype.shake=function(i,t){this.shaking||(this.shaking=!0,this.timer=t,this.intensity=i,this.originalPosition=this.entity.getPosition().clone())};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,r,s){e[0]=computeGaussian(0,s),t[0]=0,t[1]=0;var i,a,l=e[0];for(i=0,a=Math.floor(SAMPLE_COUNT/2);i<a;i++){var u=computeGaussian(i+1,s);e[2*i]=u,e[2*i+1]=u,l+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=r*h,t[4*i+2]=-o*h,t[4*i+3]=-r*h}for(i=0,a=e.length;i<a;i++)e[i]/=l}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets["+SAMPLE_COUNT+"];","uniform float uBlurWeights["+SAMPLE_COUNT+"];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),s=["varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,o,"BloomExtractShader",t),this.blurShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,r,"BloomBlurShader",t),this.combineShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,s,"BloomCombineShader",t),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,r=e.colorBuffer.height;if(o!==this.width||r!==this.height)for(this.width=o,this.height=r,this._destroy(),t=0;t<2;t++){var s=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_RGBA8,width:o>>1,height:r>>1,mipmaps:!1});s.minFilter=pc.FILTER_LINEAR,s.magFilter=pc.FILTER_LINEAR,s.addressU=pc.ADDRESS_CLAMP_TO_EDGE,s.addressV=pc.ADDRESS_CLAMP_TO_EDGE,s.name="pe-bloom-"+t;var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:s,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var r=this.device.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(this.targets[0],this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),this.drawQuad(this.targets[1],this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),this.drawQuad(this.targets[0],this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(t,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this.effect._destroy()}))};// ui-template.js
// ==========================================================================
// Declare this in every UI scripts that needs it
// ==========================================================================
/*
class UI {
    constructor(mainId) {
        this.mainElement = $(`#${mainId}`);
        this.onShow = null;
        this.onHide = null;
    }
    getChild(id) {
        return this.mainElement.find(`#${id}`);
    }
    show() {
        SoundManager.instance.play('Open UI');
        this.mainElement.show();
        if (this.onShow) {
            this.onShow();
        }
    }
    hide() {
        SoundManager.instance.play('Open UI');
        this.mainElement.hide();
        if (this.onHide) {
            this.onHide();
        }
    }
}

class ListUI extends UI {
    constructor(mainId) {
        super(mainId);
        this.itemsElement = $(`#${mainId} #items`);
    }
    clear() {
        this.itemsElement.empty();
    }
    refreshItems(data, onGetInitializedItem) {
        this.clear();
        for (let i = 0; i < data.length; i++) {
            let listItem = onGetInitializedItem(data[i]);
            let itemElement = listItem.mainElement;
            itemElement.attr('id', `#item-${i}`);
            this.itemsElement.append(itemElement);
        }
    }
}

class ListItemUI {
    constructor(html, idValues) {
        this.mainElement = $(html);
        for (let i = 0; i < idValues.length; i++) {
            if (idValues[i].text) {
                this.mainElement.find(`#${idValues[i].id}`).text(idValues[i].text);
            }
            if (idValues[i].src) {
                this.mainElement.find(`#${idValues[i].id}`).attr('src', idValues[i].src);
            }
        }
    }
}

class ListTabsUI extends ListUI {
    // TOOD: gamitin muna to ni weapons-ui, if okay, gagamitin na rin ni leaderboard
    // TODO: dito iimplement yung handling ng tabs para easy
    // TODO: thus could simplify yung pag change ng mga classes
}
*/

var Plant=pc.createScript("plant");Plant.attributes.add("surgeGrowth",{type:"number"}),Plant.attributes.add("maxSurge",{type:"number"}),Plant.prototype.initialize=function(){this.surge=0},Plant.prototype.update=function(t){Player.instance.isSurge||(this.updateSurge(t),this.updatePlayerCollision(),this.updateSprite())},Plant.prototype.updateSurge=function(t){this.surge=Math.min(this.surge+this.surgeGrowth*t,this.maxSurge)},Plant.prototype.updatePlayerCollision=function(){if(!(this.surge<this.maxSurge||Player.instance.isSurge)){var t=Player.instance.entity.getPosition();this.entity.getPosition().distance(t)<=1&&(Player.instance.addSurge(this.surge),this.surge=0)}},Plant.prototype.updateSprite=function(){let t=this.entity.script.cdsEntity.spriteEntites,e=this.surge===this.maxSurge;t[0].enabled=!e,t[1].enabled=e};var SolanaManager=pc.createScript("solanaManager");SolanaManager.instance=null,SolanaManager.prototype.initialize=function(){SolanaManager.instance=this,this.connectionUrl="https://red-late-lake.solana-mainnet.quiknode.pro/f88a154e7f97b1f789a0a1fd45c4ab48fa3f21ff/",this.cbzAddress="G4USAGAtyEfW6B5abRRNHnvn1x2Vhcxhfvdv2h3m24iW",this.bossPublicKeyStr="F6CZz6P3qAQgjF9Sdt138yK8gthmd9d9RUAhmsufhHq2",console.log("window.solana",window.solana)},SolanaManager.prototype.login=function(n,e){LoadUi.instance.uiLoading.show(),IFrameManager.instance.sendMessageToReact("login",!0,[{key:"login_success",method:e=>{localStorage.setItem("walletId",e),LoadUi.instance.uiLoading.hide(),n()}},{key:"login_failed",method:()=>{e()}}])},SolanaManager.prototype.fetchTokenBalances=async function(n,e,a){try{let a=new solanaWeb3.Connection(this.connectionUrl),o=new solanaWeb3.PublicKey(n);const t=new solanaWeb3.PublicKey(this.cbzAddress),i=await a.getBalance(o)/solanaWeb3.LAMPORTS_PER_SOL,s=await a.getParsedTokenAccountsByOwner(o,{mint:t});e({solBalance:i,cbzBalances:s.value.map((n=>{const e=n.account.data.parsed.info.tokenAmount;return{uiAmount:e.uiAmount,uiAmountString:e.uiAmountString,accountAddress:n.pubkey.toString()}}))})}catch(n){console.log(n),a(n)}},SolanaManager.prototype.payToken=async function(n,e,a){IFrameManager.instance.sendMessageToReact("pay_token",n,[{key:"pay_success",method:n=>{e(n)}},{key:"pay_failed",method:()=>{a()}}])},SolanaManager.prototype.receiveToken=async function(n,e,a,o){console.log("sending receive_token",n,e),IFrameManager.instance.sendMessageToReact("receive_token",{message:n,amount:e},[{key:"sign_success",method:n=>{a(n)}},{key:"sign_failed",method:()=>{o()}}])},SolanaManager.prototype.payTokenDesktop=async function(n,e,a){const o=new solanaWeb3.Connection(this.connectionUrl,"confirmed"),t=new solanaWeb3.PublicKey(this.cbzAddress),i=new solanaWeb3.PublicKey(localStorage.getItem("walletId")),s=new solanaWeb3.PublicKey(this.bossPublicKeyStr),c=await this.findTokenAccountByOwnerAndMint(i,t),r=await this.findTokenAccountByOwnerAndMint(s,t),l=new solanaWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),d=BigInt(n)*BigInt(Math.pow(10,9)),g=await o.getLatestBlockhash(),u=new solanaWeb3.Transaction({feePayer:i,recentBlockhash:g.blockhash}),y=[{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1}],h=new ArrayBuffer(9),w=new DataView(h);w.setUint8(0,3),w.setBigUint64(1,d,!0);const b=new solanaWeb3.TransactionInstruction({keys:y,programId:l,data:new Uint8Array(h)});u.add(b);try{let n=(await window.solana.signTransaction(u)).serialize();const a=await o.sendRawTransaction(n);await o.confirmTransaction({blockhash:g.blockhash,lastValidBlockHeight:g.lastValidBlockHeight,signature:a}),console.log("Transaction confirmed with signature:",a),e(a)}catch(n){console.error("Transaction error:",n),a(n)}},SolanaManager.prototype.findTokenAccountByOwnerAndMint=async function(n,e){const a=new solanaWeb3.Connection(this.connectionUrl,"confirmed"),o=await a.getParsedTokenAccountsByOwner(n,{mint:e});if(o.value.length>0)return o.value[0].pubkey;throw new Error("No token accounts found.")};var GoogleLogin=pc.createScript("googleLogin");GoogleLogin.instance=null,GoogleLogin.attributes.add("clientId",{type:"string",default:"1055141817351-nn732gnno6ks5gvo821pkupenn2ljem8.apps.googleusercontent.com"}),GoogleLogin.prototype.initialize=function(){GoogleLogin.instance=this,google.accounts.id.initialize({client_id:this.clientId,callback:this.onSignIn.bind(this),use_fedcm_for_prompt:!1})},GoogleLogin.prototype.onLoginClick=function(o){this.onSignInCallback=o,console.log("onLoginClick"),google.accounts.id.prompt()},GoogleLogin.prototype.onLogoutClick=function(o){google.accounts.id.disableAutoSelect(),o()},GoogleLogin.prototype.onSignIn=function(o){localStorage.setItem("googleToken",o.credential),this.onSignInCallback()};var AppleSignin=pc.createScript("appleSignin");AppleSignin.instance=null,AppleSignin.prototype.initialize=function(){AppleSignin.instance=this,console.log(AppleID)};var IFrameManager=pc.createScript("iFrameManager");IFrameManager.instance=null,IFrameManager.prototype.initialize=function(){IFrameManager.instance=this,this.callbacks={};let e=this;window.addEventListener("message",(function(a){"https://game.cyberdogz.io"===a.origin?e.callbacks[a.data.type](a.data.payload):console.log("Received message from unauthorized origin")}))},IFrameManager.prototype.sendMessageToReact=function(e,a,t){for(let e=0;e<t.length;e++)this.callbacks[t[e].key]=t[e].method;parent.postMessage({type:e,payload:a},"*")};